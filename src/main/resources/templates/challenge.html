<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>30 Ng√†y Ch·ªù Anh (Qu√¢n S·ª± 2025)</title>
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- CSS GIAO DI·ªÜN --- */
        body {
            background-color: #f0f4f8;
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        h1 {
            font-family: 'Patrick Hand', cursive;
            color: #2c3e50;
            font-size: 2.2rem;
            margin-bottom: 5px;
            text-align: center;
        }

        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 20px;
            font-size: 0.95rem;
            max-width: 600px;
        }

        /* ƒê·ªìng h·ªì ƒë·∫øm ng∆∞·ª£c */
        .countdown-box {
            background: #2d3436;
            color: #fff;
            padding: 15px 25px;
            border-radius: 50px;
            font-weight: bold;
            margin-bottom: 30px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            text-align: center;
            font-size: 1.1rem;
            border: 2px solid #fff;
        }

        /* L∆∞·ªõi 30 ng√†y */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
            gap: 12px;
            max-width: 800px;
            width: 100%;
            margin-bottom: 50px;
        }

        .day-box {
            aspect-ratio: 1;
            background: white;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            font-size: 1.2rem;
            color: #34495e;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: transform 0.2s;
            position: relative;
        }

        .day-box:hover { transform: translateY(-3px); }

        /* TR·∫†NG TH√ÅI √î: KH√ìA */
        .day-box.locked {
            background: #dfe6e9;
            color: #b2bec3;
            cursor: not-allowed;
        }
        .day-box.locked::after { content: "üîí"; font-size: 1rem; display: block; margin-top: 5px;}

        /* TR·∫†NG TH√ÅI √î: H√îM NAY (ACTIVE) */
        .day-box.active {
            background: #ffeaa7;
            border: 2px solid #fdcb6e;
            color: #d35400;
            animation: pulse 2s infinite;
        }

        /* TR·∫†NG TH√ÅI √î: HO√ÄN TH√ÄNH */
        .day-box.completed {
            background: #55efc4;
            color: #00b894;
        }
        .day-box.completed::after { content: "‚úî"; font-size: 1.2rem; display: block; }

        /* --- GIAO DI·ªÜN QU√ÇN S·ª∞ (NG√ÄY 23-30) --- */
        .day-box.military {
            background-color: #57606f; /* X√°m xanh l√≠nh */
            color: #fff;
            border: 2px dashed #a4b0be;
        }

        .day-box.military::before {
            content: "ü™ñ";
            font-size: 0.8rem;
            position: absolute;
            top: 5px;
            right: 5px;
        }

        .day-box.military.active {
            background-color: #7bed9f; /* Xanh l√° s√°ng */
            color: #2f3542;
            border: 3px solid #2ed573;
            animation: pulse-military 1.5s infinite;
        }

        .day-box.military.completed {
            background: #2ed573;
            color: white;
            border: none;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(253, 203, 110, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(253, 203, 110, 0); }
            100% { box-shadow: 0 0 0 0 rgba(253, 203, 110, 0); }
        }

        @keyframes pulse-military {
            0% { box-shadow: 0 0 0 0 rgba(46, 213, 115, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(46, 213, 115, 0); }
            100% { box-shadow: 0 0 0 0 rgba(46, 213, 115, 0); }
        }

        /* MODAL (C·ª≠a s·ªï nhi·ªám v·ª•) */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(4px);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            text-align: center;
            position: relative;
            animation: zoomIn 0.3s;
        }

        @keyframes zoomIn {
            from {transform: scale(0.5); opacity: 0;}
            to {transform: scale(1); opacity: 1;}
        }

        .task-title { color: #e17055; font-family: 'Patrick Hand', cursive; font-size: 2rem; margin: 0; }
        .military-title { color: #2ed573; font-family: 'Stencil', 'Impact', sans-serif; text-transform: uppercase; }

        .task-desc { font-size: 1.1rem; line-height: 1.6; margin: 20px 0; color: #2d3436; }

        .btn-done {
            background: #00b894;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }
        .btn-done:hover { background: #00a884; }

        .btn-close {
            position: absolute;
            top: 10px; right: 15px;
            font-size: 2rem;
            cursor: pointer;
            color: #aaa;
        }

        /* N√∫t Back */
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            text-decoration: none;
            color: #2c3e50;
            font-weight: bold;
            background: white;
            padding: 5px 15px;
            border-radius: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>

<a href="/" class="back-btn">‚¨Ö Trang ch·ªß</a>

<h1>Chi·∫øn D·ªãch 30 Ng√†y Y√™u Xa üáªüá≥</h1>
<div class="subtitle">Anh ƒëi qu√¢n s·ª± 8 ng√†y th√¥i. M·ªói ng√†y em v√†o ƒë√¢y l√†m m·ªôt nhi·ªám v·ª• nh·ªè ƒë·ªÉ ch√∫ng m√¨nh v·∫´n g·∫ßn nhau nh√©!</div>

<div class="countdown-box" id="countdown">ƒêang t·∫£i th·ªùi gian...</div>

<div class="grid-container" id="grid">
</div>

<div class="modal" id="taskModal">
    <div class="modal-content">
        <span class="btn-close" onclick="closeModal()">&times;</span>
        <h2 class="task-title" id="modalDay">Ng√†y 1</h2>
        <div class="task-desc" id="modalTask">N·ªôi dung nhi·ªám v·ª•...</div>
        <button class="btn-done" onclick="completeTask()">Em ƒë√£ ho√†n th√†nh!</button>
    </div>
</div>

<script>
    // --- C·∫§U H√åNH TH·ªúI GIAN ---
    const START_DATE = new Date("2025-12-01T00:00:00");
    const END_DATE = new Date("2025-12-30T23:59:59");
    const MILITARY_START_DAY = 23; // T·ª´ ng√†y 23 tr·ªü ƒëi l√† ch·∫ø ƒë·ªô qu√¢n s·ª±

    // --- DANH S√ÅCH 30 NHI·ªÜM V·ª§ ---
    const tasks = [
        // GIAI ƒêO·∫†N 1: 22 Ng√†y ƒë·∫ßu (Nh·∫π nh√†ng)
        "Ng√†y 1: Ng√†y ƒë·∫ßu ti√™n xa nhau. G·ª≠i cho anh m·ªôt t·∫•m ·∫£nh em c∆∞·ªùi th·∫≠t t∆∞∆°i l√†m ƒë·ªông l·ª±c nh√©.",
        "Ng√†y 2: K·ªÉ cho anh nghe m·ªôt chuy·ªán vui h√¥m nay c·ªßa em.",
        "Ng√†y 3: Nh·∫Øc nh·ªü: Em ƒë√£ u·ªëng ƒë·ªß n∆∞·ªõc ch∆∞a? Ch·ª•p c·ªëc n∆∞·ªõc g·ª≠i anh ki·ªÉm tra.",
        "Ng√†y 4: G·ª≠i cho anh link m·ªôt b√†i h√°t em ƒëang nghe nhi·ªÅu nh·∫•t.",
        "Ng√†y 5: H√¥m nay em mu·ªën ƒÉn g√¨? G·ª≠i ·∫£nh m√≥n ƒë√≥ cho anh xem 'ƒÉn k√©' b·∫±ng m·∫Øt.",
        "Ng√†y 6: Soi g∆∞∆°ng v√† t·ª± khen m√¨nh xinh ƒë·∫πp 3 l·∫ßn! Em l√† nh·∫•t.",
        "Ng√†y 7: M·ªôt tu·∫ßn r·ªìi. G·ª≠i voice chat ch√∫c anh ng·ªß ngon th·∫≠t ng·ªçt ng√†o.",
        "Ng√†y 8: Ch·ª•p ·∫£nh b·∫ßu tr·ªùi ch·ªó em v√† g·ª≠i cho anh.",
        "Ng√†y 9: Vi·∫øt t√™n anh l√™n gi·∫•y, v·∫Ω th√™m tr√°i tim r·ªìi ch·ª•p l·∫°i.",
        "Ng√†y 10: S·∫Øp ƒë·∫øn giai ƒëo·∫°n anh hu·∫•n luy·ªán cƒÉng th·∫≥ng r·ªìi, chu·∫©n b·ªã tinh th·∫ßn nh√©!",
        "Ng√†y 11: Em th√≠ch nh·∫•t b·ªô ph·∫≠n n√†o tr√™n g∆∞∆°ng m·∫∑t anh? N√≥i th·∫≠t l√≤ng nha.",
        "Ng√†y 12: ƒê·∫Øp m·∫∑t n·∫° th∆∞ gi√£n ƒëi c√¥ n∆∞∆°ng, nh·ªõ gi·ªØ g√¨n nhan s·∫Øc ƒë·ª£i anh v·ªÅ.",
        "Ng√†y 13: G·ª≠i cho anh m·ªôt meme ho·∫∑c video h√†i h∆∞·ªõc ƒë·ªÉ anh x·∫£ stress.",
        "Ng√†y 14: H√¥m nay anh nh·ªõ em qu√°. Em c√≥ nh·ªõ anh kh√¥ng?",
        "Ng√†y 15: T·ª± mua cho m√¨nh m·ªôt m√≥n ƒÉn v·∫∑t y√™u th√≠ch coi nh∆∞ anh m·ªùi.",
        "Ng√†y 16: N·∫øu r·∫£nh, h√£y g·ªçi ƒëi·ªán v·ªÅ cho m·∫π anh h·ªèi thƒÉm s·ª©c kh·ªèe m·ªôt ch√∫t nh√©.",
        "Ng√†y 17: Ch·ª•p ·∫£nh g√≥c l√†m vi·ªác ho·∫∑c g√≥c h·ªçc t·∫≠p c·ªßa em.",
        "Ng√†y 18: L√™n danh s√°ch 3 ƒë·ªãa ƒëi·ªÉm m√¨nh s·∫Ω ƒëi ch∆°i khi anh v·ªÅ.",
        "Ng√†y 19: T√¨m m·ªôt t·∫•m ·∫£nh h·ªìi b√© c·ªßa em (n·∫øu c√≥) v√† g·ª≠i cho anh.",
        "Ng√†y 20: Ch·ªâ c√≤n 3 ng√†y n·ªØa l√† ƒë·∫øn giai ƒëo·∫°n cao ƒëi·ªÉm. Em h√£y n√≥i m·ªôt l·ªùi ƒë·ªông vi√™n anh ƒëi.",
        "Ng√†y 21: Chu·∫©n b·ªã tinh th·∫ßn l√†m h·∫≠u ph∆∞∆°ng v·ªØng ch·∫Øc ch∆∞a?",
        "Ng√†y 22: Ng√†y cu·ªëi tr∆∞·ªõc khi v√†o ƒë·ª£t hu·∫•n luy·ªán cƒÉng! G·ª≠i anh m·ªôt n·ª• h√¥n gi√≥.",

        // GIAI ƒêO·∫†N 2: 8 Ng√†y cu·ªëi (Qu√¢n s·ª±)
        "Ng√†y 23 (NH·∫¨P TR·∫†I): B·∫Øt ƒë·∫ßu chu·ªói ng√†y k·ª∑ lu·∫≠t th√©p! ·ªû nh√† ngoan, ƒë·ª´ng th·ª©c khuya nh√©! ü™ñ",
        "Ng√†y 24 (HU·∫§N LUY·ªÜN): Trong n√†y ƒÉn ng·ªß ƒë√∫ng gi·ªù l·∫Øm. Em c≈©ng ph·∫£i ƒÉn u·ªëng ƒë·∫ßy ƒë·ªß thay ph·∫ßn anh nh√©.",
        "Ng√†y 25 (N·ªñI NH·ªö): Nh·ªõ em qu√°! Nhi·ªám v·ª• h√¥m nay: √îm g·∫•u b√¥ng anh t·∫∑ng v√† ng·ªß s·ªõm tr∆∞·ªõc 11h.",
        "Ng√†y 26 (C·ªê G·∫ÆNG): Anh ƒëang t·∫≠p luy·ªán v·∫•t v·∫£. H√£y g·ª≠i m·ªôt tin nh·∫Øn c·ªï v≈© th·∫≠t d√†i ƒë·ªÉ khi n√†o ƒë∆∞·ª£c c·∫ßm m√°y anh ƒë·ªçc.",
        "Ng√†y 27 (D·ªåN D·∫∏P): S·∫Øp v·ªÅ r·ªìi! H√¥m nay em h√£y d·ªçn d·∫πp ph√≤ng s·∫°ch s·∫Ω ƒë·ªÉ ƒë√≥n may m·∫Øn (v√† ƒë√≥n anh).",
        "Ng√†y 28 (L√ÄM ƒê·∫∏P): Chu·∫©n b·ªã b·ªô ƒë·ªì ƒë·∫πp nh·∫•t ƒë·ªÉ h√¥m kia ƒëi ƒë√≥n anh nh√©.",
        "Ng√†y 29 (ƒê·∫æM NG∆Ø·ª¢C): Ng√†y cu·ªëi c√πng trong tr·∫°i! Anh s·∫Øp ƒë∆∞·ª£c g·∫∑p em r·ªìi! H·ªìi h·ªôp kh√¥ng?",
        "Ng√†y 30 (V·ªÄ NH√Ä): ANH V·ªÄ R·ªíI! Nhi·ªám v·ª• cu·ªëi c√πng: Ch·∫°y ra √¥m anh ngay l·∫≠p t·ª©c! ‚ù§Ô∏è"
    ];

    const grid = document.getElementById('grid');
    const modal = document.getElementById('taskModal');
    const countdownEl = document.getElementById('countdown');
    let currentOpenDay = 0;

    // --- KH·ªûI T·∫†O L∆Ø·ªöI ---
    function initGrid() {
        const now = new Date();
        const diffTime = now - START_DATE;
        // T√≠nh xem h√¥m nay l√† ng√†y th·ª© m·∫•y (v√≠ d·ª•: ng√†y 1, ng√†y 2...)
        let currentDayIndex = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

        // X·ª≠ l√Ω logic n·∫øu ch∆∞a ƒë·∫øn ng√†y ho·∫∑c ƒë√£ qu√° ng√†y
        if (now < START_DATE) currentDayIndex = 0;

        // Render 30 √¥
        for (let i = 1; i <= 30; i++) {
            const box = document.createElement('div');
            box.className = 'day-box';
            box.innerText = i;

            // Th√™m class qu√¢n s·ª± cho 8 ng√†y cu·ªëi
            if (i >= MILITARY_START_DAY) {
                box.classList.add('military');
            }

            const isDone = localStorage.getItem('task_day_' + i) === 'true';

            if (i <= currentDayIndex) {
                // Ng√†y ƒë√£ qua ho·∫∑c h√¥m nay
                if (isDone) {
                    box.classList.add('completed');
                    box.onclick = () => showTask(i, true); // Xem l·∫°i (ch·ªâ ƒë·ªçc)
                } else if (i === currentDayIndex) {
                    box.classList.add('active'); // Ng√†y hi·ªán t·∫°i ch∆∞a l√†m
                    box.onclick = () => showTask(i, false);
                } else {
                    // Ng√†y qu√° kh·ª© qu√™n l√†m -> Cho ph√©p l√†m b√π (M√†u cam nh·∫°t)
                    box.style.background = "#fab1a0";
                    box.style.color = "#fff";
                    box.onclick = () => showTask(i, false);
                }
            } else {
                // Ng√†y t∆∞∆°ng lai -> Kh√≥a
                box.classList.add('locked');
                box.onclick = () => {
                    if (i >= MILITARY_START_DAY) {
                        alert("‚õî KHU V·ª∞C QU√ÇN S·ª∞! Ch∆∞a ƒë·∫øn ng√†y gi·∫£i m·∫≠t t√†i li·ªáu n√†y! ü™ñ");
                    } else {
                        alert("Ch∆∞a ƒë·∫øn ng√†y n√†y ƒë√¢u b√© ∆°i! Ki√™n nh·∫´n ch·ªù ƒë·ª£i nha ‚ù§Ô∏è");
                    }
                };
            }

            grid.appendChild(box);
        }
    }

    // --- HI·ªÇN TH·ªä MODAL NHI·ªÜM V·ª§ ---
    function showTask(day, readOnly) {
        currentOpenDay = day;
        let titleText = "Nhi·ªám v·ª• Ng√†y " + day;
        const modalTitle = document.getElementById('modalDay');

        // ƒê·ªïi giao di·ªán modal n·∫øu l√† ng√†y qu√¢n s·ª±
        if (day >= MILITARY_START_DAY) {
            titleText = "ü™ñ QU√ÇN S·ª∞ - NG√ÄY " + day;
            modalTitle.classList.add('military-title');
        } else {
            modalTitle.classList.remove('military-title');
        }

        modalTitle.innerText = titleText;
        document.getElementById('modalTask').innerText = tasks[day-1];

        const btn = document.querySelector('.btn-done');
        if (readOnly) {
            btn.style.display = 'none'; // ƒê√£ xong th√¨ ·∫©n n√∫t ƒëi
        } else {
            btn.style.display = 'block';
        }

        modal.style.display = 'flex';
    }

    // --- HO√ÄN TH√ÄNH NHI·ªÜM V·ª§ ---
    function completeTask() {
        if (confirm("Em ch·∫Øc ch·∫Øn ƒë√£ ho√†n th√†nh nhi·ªám v·ª• n√†y ch·ª©?")) {
            // 1. L∆∞u v√†o tr√¨nh duy·ªát (ƒë·ªÉ l·∫ßn sau v√†o v·∫´n th·∫•y xanh)
            localStorage.setItem('task_day_' + currentOpenDay, 'true');

            // 2. Chu·∫©n b·ªã n·ªôi dung g·ª≠i Server
            const taskContent = tasks[currentOpenDay-1];
            let prefix = "";
            if (currentOpenDay >= MILITARY_START_DAY) {
                prefix = "[QU√ÇN S·ª∞ KH·∫®N C·∫§P] ";
            }
            const msgToSend = prefix + taskContent;

            // 3. G·ªçi API (K·∫øt n·ªëi v·ªõi Controller b·∫°n ƒë√£ s·ª≠a)
            fetch(`/api/complete-challenge?day=${currentOpenDay}&msg=${encodeURIComponent(msgToSend)}`, {
                method: 'POST'
            })
                .then(response => {
                    if (response.ok) {
                        return response.text();
                    } else {
                        throw new Error("Ch∆∞a ƒë·∫øn ng√†y m·ªü kh√≥a (Check Server)");
                    }
                })
                .then(data => {
                    alert(data); // Hi·ªán th√¥ng b√°o t·ª´ Server
                    location.reload(); // T·∫£i l·∫°i trang
                })
                .catch(err => {
                    alert("L·ªói: " + err.message);
                });
        }
    }

    function closeModal() {
        modal.style.display = 'none';
    }

    // --- ƒê·ªíNG H·ªí ƒê·∫æM NG∆Ø·ª¢C TH√îNG MINH ---
    setInterval(() => {
        const now = new Date();

        // Tr∆∞·ªùng h·ª£p 1: Ch∆∞a ƒë·∫øn ng√†y 01/12
        if (now < START_DATE) {
            const distanceStart = START_DATE - now;
            const hours = Math.floor((distanceStart % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distanceStart % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distanceStart % (1000 * 60)) / 1000);

            countdownEl.innerText = `‚è≥ CH·ªú L·ªÜNH XU·∫§T PH√ÅT: C√≤n ${hours}g ${minutes}p ${seconds}s n·ªØa s·∫Ω m·ªü kh√≥a Ng√†y 1!`;
            countdownEl.style.backgroundColor = "#e17055"; // Cam
            return;
        }

        // Tr∆∞·ªùng h·ª£p 2: ƒêang trong th·ªùi gian 30 ng√†y
        const distance = END_DATE - now;
        if (distance < 0) {
            // ƒê√£ qua ng√†y 30/12
            countdownEl.innerText = "üéâ CH√öC M·ª™NG! ANH ƒê√É HO√ÄN TH√ÄNH NVQS V√Ä TR·ªû V·ªÄ! ‚ù§Ô∏è";
            countdownEl.style.backgroundColor = "#00b894"; // Xanh
        } else {
            // ƒêang ƒë·∫øm ng∆∞·ª£c
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));

            // ƒê·ªïi m√†u n·∫øu v√†o giai ƒëo·∫°n qu√¢n s·ª±
            if (now > new Date("2025-12-23T00:00:00")) {
                countdownEl.innerText = `ü™ñ GIAI ƒêO·∫†N QU√ÇN S·ª∞: C√≤n ${days} ng√†y ${hours} gi·ªù n·ªØa l√† anh v·ªÅ!`;
                countdownEl.style.backgroundColor = "#57606f"; // X√°m l√≠nh
            } else {
                countdownEl.innerText = `‚ù§Ô∏è ƒêANG Y√äU XA: C√≤n ${days} ng√†y ${hours} gi·ªù n·ªØa l√† anh v·ªÅ!`;
                countdownEl.style.backgroundColor = "#2d3436"; // ƒêen
            }
        }
    }, 1000);

    // Ch·∫°y kh·ªüi t·∫°o
    initGrid();

</script>
</body>
</html>