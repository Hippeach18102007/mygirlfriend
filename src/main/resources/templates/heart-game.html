<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B·∫Øt Tr·ªçn T√¨nh Y√™u ‚ù§Ô∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #ffdde1;
            font-family: 'Press Start 2P', cursive; /* Font ch·ªØ Game Pixel */
            text-align: center;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            user-select: none; /* Ch·ªëng b√¥i ƒëen khi click nhanh */
        }

        h1 {
            color: #d63384;
            line-height: 1.5;
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .score-board {
            background: #fff;
            padding: 10px 20px;
            border-radius: 10px;
            border: 4px solid #333;
            margin-bottom: 20px;
            font-size: 1.2rem;
            color: #333;
        }

        /* L∆∞·ªõi tr√≤ ch∆°i */
        .game {
            width: 350px;
            height: 350px;
            display: flex;
            flex-wrap: wrap;
            margin: 0 auto;
            border: 5px solid #333;
            border-radius: 10px;
            background-color: #84fab0; /* M√†u n·ªÅn c·ªè */
            cursor: url('https://cdn-icons-png.flaticon.com/32/7475/7475620.png'), auto; /* Con tr·ªè h√¨nh c√°i b√∫a */
        }

        .hole {
            flex: 1 0 33.33%;
            overflow: hidden;
            position: relative;
            border: 1px solid rgba(0,0,0,0.1);
        }

        /* C√°i h·ªë ƒë·∫•t */
        .hole::after {
            content: '';
            display: block;
            background: url('https://cdn-icons-png.flaticon.com/512/10842/10842247.png') bottom center no-repeat;
            background-size: contain;
            width: 100%;
            height: 40px;
            position: absolute;
            bottom: -15px;
            z-index: 2;
        }

        /* Tr√°i tim (Mole) */
        .heart {
            background: url('https://cdn-icons-png.flaticon.com/512/210/210545.png') bottom center no-repeat;
            background-size: 60%;
            position: absolute;
            top: 100%; /* Gi·∫•u b√™n d∆∞·ªõi */
            width: 100%;
            height: 100%;
            transition: top 0.4s;
            z-index: 1;
        }

        /* Tr√°i tim v·ª° (B·∫´y) */
        .broken-heart {
            background: url('https://cdn-icons-png.flaticon.com/512/10608/10608773.png') bottom center no-repeat;
            background-size: 60%;
            position: absolute;
            top: 100%;
            width: 100%;
            height: 100%;
            transition: top 0.4s;
            z-index: 1;
        }

        /* Class ƒë·ªÉ hi·ªán l√™n */
        .hole.up .heart, .hole.up .broken-heart {
            top: 10px;
        }

        /* N√∫t b·∫Øt ƒë·∫ßu */
        .btn-start {
            margin-top: 20px;
            padding: 15px 30px;
            font-family: 'Press Start 2P', cursive;
            font-size: 1rem;
            background: #d63384;
            color: white;
            border: 4px solid #333;
            cursor: pointer;
            box-shadow: 5px 5px 0 #333;
        }

        .btn-start:active {
            transform: translate(2px, 2px);
            box-shadow: 3px 3px 0 #333;
        }

        .btn-start:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .back-link {
            margin-top: 20px;
            text-decoration: none;
            color: #d63384;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>

<h1>B·∫Øt Tr·ªçn<br>T√¨nh Y√™u ‚ù§Ô∏è</h1>

<div class="score-board">
    ƒêi·ªÉm: <span id="score">0</span> <br>
    Th·ªùi gian: <span id="time-left">30</span>s
</div>

<div class="game">
    <div class="hole hole1"><div class="heart"></div></div>
    <div class="hole hole2"><div class="heart"></div></div>
    <div class="hole hole3"><div class="heart"></div></div>
    <div class="hole hole4"><div class="heart"></div></div>
    <div class="hole hole5"><div class="heart"></div></div>
    <div class="hole hole6"><div class="heart"></div></div>
    <div class="hole hole7"><div class="heart"></div></div>
    <div class="hole hole8"><div class="heart"></div></div>
    <div class="hole hole9"><div class="heart"></div></div>
</div>

<button class="btn-start" onclick="startGame()">B·∫ÆT ƒê·∫¶U!</button>
<a href="/" class="back-link">‚¨Ö V·ªÅ Trang Ch·ªß</a>

<script>
    const holes = document.querySelectorAll('.hole');
    const scoreBoard = document.querySelector('#score');
    const timeBoard = document.querySelector('#time-left');
    const hearts = document.querySelectorAll('.heart');
    const btnStart = document.querySelector('.btn-start');

    let lastHole;
    let timeUp = false;
    let score = 0;
    let countdown;

    // Random th·ªùi gian xu·∫•t hi·ªán
    function randomTime(min, max) {
        return Math.round(Math.random() * (max - min) + min);
    }

    // Random h·ªë
    function randomHole(holes) {
        const idx = Math.floor(Math.random() * holes.length);
        const hole = holes[idx];
        if (hole === lastHole) {
            return randomHole(holes);
        }
        lastHole = hole;
        return hole;
    }

    // L√†m tr√°i tim nh·∫£y l√™n
    function peep() {
        const time = randomTime(400, 1000); // T·ªëc ƒë·ªô nh·∫£y
        const hole = randomHole(holes);

        // 20% c∆° h·ªôi xu·∫•t hi·ªán tr√°i tim v·ª° (B·∫´y)
        const isTrap = Math.random() > 0.8;

        // X√≥a class c≈©
        const heartDiv = hole.querySelector('div');
        heartDiv.className = isTrap ? 'broken-heart' : 'heart';

        hole.classList.add('up');

        setTimeout(() => {
            hole.classList.remove('up');
            if (!timeUp) peep();
        }, time);
    }

    function startGame() {
        if(btnStart.disabled) return;

        scoreBoard.textContent = 0;
        timeBoard.textContent = 30;
        timeUp = false;
        score = 0;
        btnStart.disabled = true;
        btnStart.textContent = "ƒêang ch∆°i...";

        peep();

        // ƒê·∫øm ng∆∞·ª£c
        let timeLeft = 30;
        countdown = setInterval(() => {
            timeLeft--;
            timeBoard.textContent = timeLeft;
            if(timeLeft <= 0) {
                clearInterval(countdown);
                endGame();
            }
        }, 1000);
    }

    function bonk(e) {
        if(!e.isTrusted) return; // Ch·ªëng hack click b·∫±ng script

        const item = this;
        const parentHole = item.parentNode;

        // N·∫øu l√† tr√°i tim ƒë·ªè -> C·ªông ƒëi·ªÉm
        if (item.classList.contains('heart')) {
            score++;
            parentHole.classList.remove('up'); // ƒê·∫≠p tr√∫ng th√¨ th·ª•t xu·ªëng ngay
            scoreBoard.textContent = score;
        }
        // N·∫øu l√† tr√°i tim v·ª° -> Tr·ª´ ƒëi·ªÉm
        else if (item.classList.contains('broken-heart')) {
            score = Math.max(0, score - 2); // Tr·ª´ 2 ƒëi·ªÉm
            scoreBoard.textContent = score;
            alert("√Å √°! ƒê·ª´ng b·∫Øt tr√°i tim v·ª°! üíî");
            parentHole.classList.remove('up');
        }
    }

    function endGame() {
        timeUp = true;
        btnStart.disabled = false;
        btnStart.textContent = "CH∆†I L·∫†I";

        let msg = "";
        if(score > 20) msg = "ƒê·ªânh c·ªßa ch√≥p! Tay v·ª£ nhanh nh∆∞ ch·ªõp! ‚ö°";
        else if(score > 10) msg = "Kh√° l·∫Øm! C·ªë g·∫Øng l·∫ßn sau nhanh h∆°n n·ªØa nh√©! üëç";
        else msg = "H∆°i ch·∫≠m nha! Ch∆°i l·∫°i ƒë·ªÉ luy·ªán tay ƒëi n√†o! üòÇ";

        alert(`H·∫øt gi·ªù!\nƒêi·ªÉm c·ªßa em: ${score}\n${msg}`);

        // G·ª≠i ƒëi·ªÉm v·ªÅ Server -> Discord
        if(score > 0) {
            fetch(`/api/submit-score?score=${score}`, { method: 'POST' });
        }
    }

    // G·∫Øn s·ª± ki·ªán click cho t·∫•t c·∫£ c√°c tr√°i tim (k·ªÉ c·∫£ class thay ƒë·ªïi)
    // Ch√∫ng ta g·∫Øn v√†o th·∫ª div con c·ªßa hole
    holes.forEach(hole => {
        const item = hole.querySelector('div');
        item.addEventListener('click', bonk);
        // H·ªó tr·ª£ c·∫£m ·ª©ng ƒëi·ªán tho·∫°i
        item.addEventListener('touchstart', bonk);
    });

</script>
</body>
</html>