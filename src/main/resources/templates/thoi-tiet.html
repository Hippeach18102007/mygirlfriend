<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D·ª± B√°o T√¨nh Y√™u</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0; padding: 20px; font-family: 'Quicksand', sans-serif; display: flex;
            flex-direction: column; justify-content: center; align-items: center; min-height: 100vh;
            background: linear-gradient(135deg, #4e54c8, #8f94fb); /* B·∫ßu tr·ªùi xanh t√≠m */
            color: white; text-align: center;
        }
        h1 {
            font-family: 'Playfair+Display', serif; font-size: 2.8em;
            text-shadow: 0 0 15px rgba(255,255,255,0.5); margin-bottom: 40px;
        }
        .weather-container {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .weather-card {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            width: 300px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            animation: fade-in 1s forwards;
        }
        .weather-card h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2em; margin-top: 0; color: #fff;
        }
        .temp {
            font-size: 3.5em; font-weight: bold; margin: 10px 0;
            text-shadow: 2px 2px 5px rgba(0,0,0,0.2);
        }
        .description {
            font-size: 1.2em; font-style: italic; color: #ddd;
        }
        .advice {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            font-size: 1.1em;
            font-weight: 500;
            line-height: 1.6;
        }
        .advice-title {
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
            color: #ffd700; /* M√†u v√†ng gold */
        }

        .navigation-links { display: flex; justify-content: center; gap: 15px; margin-top: 50px; }
        .nav-button { background-color: rgba(255,255,255,0.2); color: white; border: 1px solid white; padding: 10px 20px; font-size: 0.9em; font-weight: bold; border-radius: 50px; cursor: pointer; text-decoration: none; transition: all 0.3s; }
        .nav-button:hover { background-color: white; color: black; }

        @keyframes fade-in { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<h1>D·ª± B√°o Th·ªùi Ti·∫øt Y√™u Th∆∞∆°ng üå§Ô∏è</h1>

<div class="weather-container">
    <div class="weather-card">
        <h2>H√† N·ªôi</h2>
        <div class="temp" id="hanoi-temp">...¬∞C</div>
        <div class="description" id="hanoi-desc">ƒêang t·∫£i...</div>
        <div class="advice">
            <span class="advice-title">L·ªùi khuy√™n cho ch·ªã:</span>
            <span id="hanoi-advice">...</span>
        </div>
    </div>

    <div class="weather-card">
        <h2>Vƒ©nh Y√™n</h2>
        <div class="temp" id="vinh-yen-temp">...¬∞C</div>
        <div class="description" id="vinh-yen-desc">ƒêang t·∫£i...</div>
        <div class="advice">
            <span class="advice-title">L·ªùi khuy√™n cho ch·ªã:</span>
            <span id="vinh-yen-advice">...</span>
        </div>
    </div>
</div>

<div class="navigation-links">
    <a th:href="@{/gui-chi}" class="nav-button">Quay l·∫°i Trang Th∆∞</a>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // T·ªça ƒë·ªô
        const hanoiCoords = { lat: 21.0285, lon: 105.8542 };
        const vinhYenCoords = { lat: 21.309, lon: 105.594 };

        // H√†m g·ªçi API
        async function fetchWeather(lat, lon, cityId) {
            const apiUrl = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,apparent_temperature,weather_code`;

            try {
                const response = await fetch(apiUrl);
                const data = await response.json();

                const current = data.current;
                const temp = Math.round(current.temperature_2m);
                const feelsLike = Math.round(current.apparent_temperature);
                const weatherCode = current.weather_code;

                // L·∫•y m√¥ t·∫£ v√† l·ªùi khuy√™n
                const description = getWeatherDescription(weatherCode);
                const advice = getClothingAdvice(feelsLike, weatherCode); // D√πng "feelsLike" ƒë·ªÉ cho l·ªùi khuy√™n

                // C·∫≠p nh·∫≠t l√™n HTML
                document.getElementById(`${cityId}-temp`).textContent = `${temp}¬∞C`;
                document.getElementById(`${cityId}-desc`).textContent = `${description} (C·∫£m gi√°c nh∆∞ ${feelsLike}¬∞C)`;
                document.getElementById(`${cityId}-advice`).textContent = advice;

            } catch (error) {
                console.error(`L·ªói khi l·∫•y th·ªùi ti·∫øt ${cityId}:`, error);
                document.getElementById(`${cityId}-advice`).textContent = "L·ªói, kh√¥ng t·∫£i ƒë∆∞·ª£c d·ª± b√°o :(";
            }
        }

        // H√†m d·ªãch code th·ªùi ti·∫øt (WMO) sang m√¥ t·∫£
        function getWeatherDescription(code) {
            const descriptions = {
                0: "Tr·ªùi quang m√¢y ‚òÄÔ∏è",
                1: "Tr·ªùi trong",
                2: "√çt m√¢y üå§Ô∏è",
                3: "Tr·ªùi c√≥ m√¢y ‚òÅÔ∏è",
                45: "S∆∞∆°ng m√π",
                48: "S∆∞∆°ng m√π d√†y ƒë·∫∑c",
                51: "M∆∞a ph√π nh·∫π",
                53: "M∆∞a ph√π v·ª´a",
                55: "M∆∞a ph√π d√†y",
                61: "M∆∞a r√†o nh·∫π üåßÔ∏è",
                63: "M∆∞a r√†o v·ª´a",
                65: "M∆∞a to",
                80: "M∆∞a r√†o nh·∫π üåßÔ∏è",
                81: "M∆∞a r√†o v·ª´a",
                82: "M∆∞a r√†o x·ªëi x·∫£ ‚õàÔ∏è"
            };
            return descriptions[code] || "Kh√¥ng r√µ";
        }

        // --- H√ÄM QUAN TR·ªåNG NH·∫§T: ƒê∆ØA RA L·ªúI KHUY√äN ---
        function getClothingAdvice(feelsLike, weatherCode) {
            let advice = "";

            if (feelsLike > 30) {
                advice = "N√≥ng l·∫Øm! Ch·ªã m·∫∑c ƒë·ªì th·∫≠t m·ªèng m√°t, u·ªëng nhi·ªÅu n∆∞·ªõc v√† nh·ªõ che n·∫Øng nh√©.";
            } else if (feelsLike > 25) {
                advice = "Tr·ªùi ·∫•m √°p. M·∫∑c √°o ph√¥ng ho·∫∑c v√°y l√† xinh nh·∫•t r·ªìi, ch·ªã y√™u.";
            } else if (feelsLike > 20) {
                advice = "Th·ªùi ti·∫øt ƒë·∫πp, h∆°i m√°t m·∫ª. Ch·ªã mang theo m·ªôt √°o kho√°c m·ªèng l√† v·ª´a xinh.";
            } else if (feelsLike > 15) {
                advice = "Tr·ªùi se l·∫°nh r·ªìi. Ch·ªã nh·ªõ m·∫∑c √°o d√†i tay v√† kho√°c √°o gi√≥ nh√©.";
            } else {
                advice = "L·∫°nh l·∫Øm ƒë√≥! Ch·ªã ph·∫£i m·∫∑c √°o len, √°o kho√°c d√†y, qu√†ng khƒÉn v√† ƒëi t·∫•t cho em!";
            }

            // Ki·ªÉm tra m∆∞a (m√£ 51-82)
            if (weatherCode >= 51 && weatherCode <= 82) {
                advice += " √Ä, c√≥ v·∫ª nh∆∞ tr·ªùi m∆∞a, ch·ªã nh·ªõ mang √¥ ho·∫∑c √°o m∆∞a nha! ‚òî";
            }

            return advice;
        }

        // Ch·∫°y
        fetchWeather(hanoiCoords.lat, hanoiCoords.lon, 'hanoi');
        fetchWeather(vinhYenCoords.lat, vinhYenCoords.lon, 'vinh-yen');
    });
</script>

</body>
</html>