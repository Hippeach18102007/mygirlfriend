<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G·ª≠i Ch·ªã, Ng∆∞·ªùi Em Th∆∞∆°ng</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Quicksand:wght@300..700&display=swap" rel="stylesheet">

    <style>
        /* ... To√†n b·ªô CSS c≈© c·ªßa b·∫°n gi·ªØ nguy√™n ... */
        body { margin: 0; padding: 20px; font-family: 'Quicksand', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; background-image: linear-gradient(to top, rgba(194, 24, 91, 0.2), rgba(0, 0, 0, 0.5)), url('https://images.unsplash.com/photo-1502673530728-f79b41d2b5ea?q=80&w=2070&auto-format&fit=crop'); background-repeat: no-repeat; background-position: center center; background-size: cover; backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); }
        .letter-container { background-color: #faf6f0; padding: 40px 50px; border-radius: 15px; box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3); max-width: 600px; width: 90%; text-align: center; border: 1px solid rgba(255, 255, 255, 0.2); }
        h1, h2, .signature { font-family: 'Playfair Display', serif; }
        h1 { font-size: 2.5em; color: #c2185b; margin-bottom: 20px; }
        h2 { color: #555; font-size: 1.5em; }
        .message { font-size: 1.1em; line-height: 1.8; color: #333; text-align: left; margin-bottom: 30px; }
        .signature { font-style: italic; font-size: 1.3em; color: #555; text-align: right; margin-top: 20px; }
        @keyframes fade-in-up { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .letter-container { animation: fade-in-up 0.8s forwards cubic-bezier(0.2, 0.8, 0.2, 1); }
        .heart { animation: beat 1.5s infinite, fade-in-up 0.8s 0.2s forwards cubic-bezier(0.2, 0.8, 0.2, 1); opacity: 0; }
        h1 { animation: fade-in-up 0.8s 0.4s forwards cubic-bezier(0.2, 0.8, 0.2, 1); opacity: 0; }
        .message { animation: fade-in-up 0.8s 0.6s forwards cubic-bezier(0.2, 0.8, 0.2, 1); opacity: 0; }
        .signature { animation: fade-in-up 0.8s 0.8s forwards cubic-bezier(0.2, 0.8, 0.2, 1); opacity: 0; }
        .reply-section { animation: fade-in-up 0.8s 1.1s forwards cubic-bezier(0.2, 0.8, 0.2, 1); opacity: 0; }
        .heart { font-size: 3em; color: #e91e63; }
        @keyframes beat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
        .memories-link { margin-top: 30px; padding-bottom: 30px; animation: fade-in-up 0.8s 0.9s forwards cubic-bezier(0.2, 0.8, 0.2, 1); opacity: 0; }
        .memory-button { background-color: transparent; color: #c2185b; border: 2px solid #c2185b; padding: 10px 20px; font-size: 1em; font-family: 'Quicksand', sans-serif; font-weight: bold; border-radius: 50px; cursor: pointer; text-decoration: none; transition: all 0.3s; }
        .memory-button:hover { background-color: #c2185b; color: white; transform: scale(1.05); }
        .reply-section { margin-top: 40px; border-top: 1px dashed #ccc; padding-top: 30px; }
        textarea { width: 100%; min-height: 100px; padding: 15px; font-family: 'Quicksand', sans-serif; font-size: 1em; border-radius: 8px; border: 1px solid #ddd; margin-top: 10px; box-sizing: border-box; transition: box-shadow 0.3s; }
        textarea:focus { outline: none; border-color: #c2185b; box-shadow: 0 0 10px rgba(225, 30, 99, 0.2); }
        button { background-color: #e91e63; color: white; border: none; padding: 12px 25px; font-size: 1.1em; font-family: 'Quicksand', sans-serif; font-weight: bold; border-radius: 50px; cursor: pointer; margin-top: 15px; transition: all 0.3s; box-shadow: 0 4px 15px rgba(225, 30, 99, 0.4); }
        button:hover { background-color: #c2185b; transform: translateY(-2px); box-shadow: 0 6px 20px rgba(225, 30, 99, 0.5); }
        button:disabled { background-color: #ccc; cursor: not-allowed; box-shadow: none; transform: none; }
        input[type="file"] { margin-top: 15px; border: 1px dashed #c2185b; padding: 10px; border-radius: 8px; width: 100%; box-sizing: border-box; background-color: #fff0f5; cursor: pointer; }
        #statusMessage { margin-top: 15px; padding: 10px; border-radius: 5px; font-weight: bold; display: none; }
        #statusMessage.success { background-color: #dff0d8; color: #3c763d; }
        #statusMessage.error { background-color: #f2dede; color: #a94442; }
        .youtube-player-hidden { position: absolute; width: 1px; height: 1px; overflow: hidden; opacity: 0; z-index: -1; }
        #volume-toggle { position: fixed; bottom: 20px; right: 20px; width: 50px; height: 50px; background-color: rgba(0, 0, 0, 0.5); color: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 24px; cursor: pointer; z-index: 1001; transition: background-color 0.3s, transform 0.3s; }
        #volume-toggle:hover { background-color: #e91e63; transform: scale(1.1); }
        .memories-link {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
    </style>
</head>
<body>

<div class="letter-container">
    <div class="heart">&#10084;</div>
    <h1>G·ª≠i ch·ªã, <span th:text="${tenNguoiNhan}"></span>!</h1>
    <p class="message" th:utext="${loiNhanYeuThuong}"></p>
    <p class="signature">Th√¢n th∆∞∆°ng,<br><span th:text="${tenNguoiGui}"></span></p>
    <div class="memories-link">
        <a th:href="@{/ky-niem}" class="memory-button">Xem nh·ªØng k·ª∑ ni·ªám c·ªßa ch√∫ng m√¨nh &#128149;</a>
    </div>
    <div class="memories-link">
        <a th:href="@{/dem-ngay}" class="memory-button">ƒê·∫øm Ng√†y Y√™u üíñ</a>
        <a th:href="@{/ky-niem}" class="memory-button">Xem k·ª∑ ni·ªám &#128149;</a>
        <a th:href="@{/nghe-nhac}" class="memory-button">Nghe nh·∫°c üé∂</a>
    </div>
    <div class="reply-section">
        <h2>Ch·ªã c√≥ mu·ªën nh·∫Øn l·∫°i g√¨ cho em kh√¥ng?</h2>
        <form id="replyForm" th:action="@{/gui-chi}" method="post" enctype="multipart/form-data">
            <textarea name="reply_message" placeholder="Vi·∫øt l·ªùi nh·∫Øn c·ªßa ch·ªã ·ªü ƒë√¢y..." required></textarea>
            <input type="file" name="imageFile" accept="image/*">
            <button id="submitButton" type="submit">&#10084; G·ª≠i cho em</button>
        </form>
        <div id="statusMessage"></div>
    </div>
</div>

<div id="volume-toggle">üîá</div>
<script src="https://www.youtube.com/iframe_api"></script>

<script>
    // --- Code x·ª≠ l√Ω g·ª≠i form ---
    document.addEventListener("DOMContentLoaded", function() {
        // ... (ph·∫ßn code n√†y gi·ªØ nguy√™n)
        const form = document.getElementById('replyForm');
        const statusMessage = document.getElementById('statusMessage');
        const submitButton = document.getElementById('submitButton');
        form.addEventListener('submit', function(event) {
            event.preventDefault();
            submitButton.disabled = true;
            submitButton.textContent = 'ƒêang g·ª≠i...';
            const formData = new FormData(form);
            fetch(form.action, { method: 'POST', body: formData })
                .then(response => {
                    if (!response.ok) { return response.text().then(text => { throw new Error(text || 'ƒê√£ c√≥ l·ªói x·∫£y ra.'); }); }
                    return response.text();
                })
                .then(successMessage => {
                    statusMessage.textContent = successMessage;
                    statusMessage.className = 'success';
                    statusMessage.style.display = 'block';
                    form.reset();
                })
                .catch(error => {
                    statusMessage.textContent = 'L·ªói: ' + error.message;
                    statusMessage.className = 'error';
                    statusMessage.style.display = 'block';
                })
                .finally(() => {
                    submitButton.disabled = false;
                    submitButton.innerHTML = '&#10084; G·ª≠i cho em';
                });
        });
    });

    // --- SCRIPT M·ªöI CHO YOUTUBE PLAYER ---
    let player;
    let isMuted = true;
    let isPlayerStarted = false; // Bi·∫øn c·ªù ƒë·ªÉ ki·ªÉm tra xem player ƒë√£ ch·∫°y l·∫ßn n√†o ch∆∞a
    const volumeButton = document.getElementById('volume-toggle');

    function onYouTubeIframeAPIReady() {
        player = new YT.Player('youtube-player'); // Kh√¥ng c·∫ßn event 'onReady' n·ªØa
    }

    volumeButton.addEventListener('click', function() {
        // N·∫øu ƒë√¢y l√† l·∫ßn click ƒë·∫ßu ti√™n
        if (!isPlayerStarted) {
            player.playVideo(); // B·∫Øt ƒë·∫ßu ph√°t video
            player.unMute(); // B·∫≠t ti·∫øng
            volumeButton.textContent = 'üîä';
            isMuted = false;
            isPlayerStarted = true; // ƒê√°nh d·∫•u l√† ƒë√£ ch·∫°y
        } else {
            // Cho nh·ªØng l·∫ßn click sau (ch·ªâ b·∫≠t/t·∫Øt ti·∫øng)
            if (isMuted) {
                player.unMute();
                volumeButton.textContent = 'üîä';
                isMuted = false;
            } else {
                player.mute();
                volumeButton.textContent = 'üîá';
                isMuted = true;
            }
        }
    });
</script>

<div class="youtube-player-hidden">
    <iframe id="youtube-player" src="https://www.youtube.com/embed/EFJ7kDjwI6w?autoplay=1&loop=1&playlist=EFJ7kDjwI6w&controls=0&mute=1&enablejsapi=1" frameborder="0" allow="autoplay; encrypted-media"></iframe>
</div>

</body>
</html>