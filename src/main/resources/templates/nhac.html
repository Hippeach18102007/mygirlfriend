<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Góc Âm Nhạc Lãng Mạn</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
    <style>
        :root { --primary-color: #f06292; --secondary-color: #e91e63; }
        body { margin: 0; padding: 20px; font-family: 'Quicksand', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; background-image: linear-gradient(to top, rgba(20, 20, 20, 0.7), rgba(0, 0, 0, 0.9)), url('https://images.unsplash.com/photo-1511671782779-c97d-3d-27a1d4?q=80&w=2070&auto-format&fit=crop'); background-repeat: no-repeat; background-position: center center; background-size: cover; backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); color: white; overflow: hidden; }
        .music-container { background: rgba(10, 10, 10, 0.6); padding: 40px; border-radius: 15px; box-shadow: 0 0 40px rgba(240, 98, 146, 0.3); max-width: 600px; width: 90%; text-align: center; border: 1px solid rgba(255, 255, 255, 0.2); animation: fade-in-up 1s forwards cubic-bezier(0.2, 0.8, 0.2, 1); position: relative; z-index: 2; }
        #player-wrapper { width: 100%; aspect-ratio: 16 / 9; margin-bottom: 20px; border-radius: 10px; overflow: hidden; border: 2px solid rgba(240, 98, 146, 0.5); box-shadow: 0 0 20px rgba(240, 98, 146, 0.4); background-color: #000; position: relative; }
        #player { width: 100%; height: 100%; }
        #song-info { margin-bottom: 25px; position: relative; }
        #song-title { font-family: 'Playfair Display', serif; font-size: 2em; margin: 0; color: #fff; text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 20px var(--primary-color), 0 0 30px var(--primary-color); animation: pulse-text 4s infinite alternate; }
        .controls { display: flex; justify-content: center; align-items: center; gap: 20px; margin-bottom: 30px; }
        .control-btn { background: transparent; border: 2px solid var(--primary-color); color: var(--primary-color); width: 60px; height: 60px; border-radius: 50%; font-size: 24px; cursor: pointer; transition: all 0.3s ease; display: flex; justify-content: center; align-items: center; text-shadow: 0 0 10px var(--primary-color); box-shadow: inset 0 0 10px rgba(240, 98, 146, 0.5), 0 0 10px rgba(240, 98, 146, 0.5); }
        .control-btn:hover { background-color: var(--primary-color); color: black; box-shadow: inset 0 0 10px rgba(240, 98, 146, 0.8), 0 0 20px rgba(240, 98, 146, 0.8); transform: scale(1.1); }
        #play-pause-btn { width: 70px; height: 70px; font-size: 30px; background-color: var(--primary-color); color: black; }

        /* THÊM CSS CHO TRẠNG THÁI VÔ HIỆU HÓA */
        .control-btn:disabled {
            cursor: not-allowed;
            background: transparent;
            border-color: #555;
            color: #555;
            box-shadow: none;
            text-shadow: none;
        }
        .control-btn:disabled:hover {
            transform: none;
            background-color: transparent;
        }

        .navigation-links { display: flex; justify-content: center; gap: 15px; border-top: 1px solid rgba(255,255,255,0.2); padding-top: 30px; }
        .nav-button { background-color: transparent; color: white; border: 1px solid white; padding: 10px 20px; font-size: 0.9em; font-weight: bold; border-radius: 50px; cursor: pointer; text-decoration: none; transition: all 0.3s; }
        .nav-button:hover { background-color: white; color: black; }
        #visualizer { position: absolute; bottom: 120px; left: 50%; transform: translateX(-50%); display: flex; justify-content: center; align-items: flex-end; height: 50px; gap: 4px; }
        .bar { width: 6px; background: linear-gradient(to top, var(--primary-color), #ff80ab); border-radius: 2px; animation: bounce 1.5s infinite ease-in-out alternate; }
        .bar:nth-child(2) { animation-delay: -0.2s; } .bar:nth-child(3) { animation-delay: -0.4s; } .bar:nth-child(4) { animation-delay: -0.6s; } .bar:nth-child(5) { animation-delay: -0.8s; } .bar:nth-child(6) { animation-delay: -1s; } .bar:nth-child(7) { animation-delay: -1.2s; }
        #retry-button { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: none; background-color: var(--primary-color); color: black; border: none; padding: 15px 30px; border-radius: 50px; font-size: 1.1em; font-weight: bold; cursor: pointer; transition: all 0.3s; }
        #retry-button:hover { transform: translate(-50%, -50%) scale(1.1); }
        @keyframes fade-in-up { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse-text { from { text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 20px var(--primary-color), 0 0 30px var(--primary-color); } to { text-shadow: 0 0 10px #fff, 0 0 20px var(--primary-color), 0 0 30px var(--primary-color), 0 0 40px var(--primary-color); } }
        @keyframes bounce { from { height: 5px; } to { height: 50px; } }
    </style>
</head>
<body>

<div class="music-container">
    <div id="player-wrapper">
        <div id="player"></div>
        <button id="retry-button">Thử lại</button>
    </div>
    <div id="song-info">
        <h2 id="song-title">Đang tải trình phát nhạc...</h2>
    </div>
    <div id="visualizer">
        <div class="bar"></div><div class="bar"></div><div class="bar"></div>
        <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
    </div>
    <div class="controls">
        <button id="prev-btn" class="control-btn" disabled>⏮</button>
        <button id="play-pause-btn" class="control-btn" disabled>▶️</button>
        <button id="next-btn" class="control-btn" disabled>⏭</button>
    </div>
    <div class="navigation-links">
        <a th:href="@{/gui-chi}" class="nav-button">Quay lại trang thư</a>
        <a th:href="@{/ky-niem}" class="nav-button">Xem kỷ niệm</a>
    </div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
    const playlist = [
        { videoId: '4S3lNyQPVy8', title: 'Hà Anh Tuấn - Medley' },
        { videoId: 'rtOvBOTyX00', title: 'A Thousand Years - Christina Perri' },
        { videoId: '2Vv-BfVoq4g', title: 'Perfect - Ed Sheeran' },
        { videoId: 'VI47bTJaMe4', title: 'Em Là Kẻ Đáng Thương - Phát Huy T4' },
        { videoId: 'lp-EO5I60KA', title: 'Thinking Out Loud - Ed Sheeran' },
        { videoId: 'NPBCbTZWnq0', title: 'River flow in you' },
    ];

    let player;
    let currentTrack = 0;
    const songTitleElement = document.getElementById('song-title');
    const playPauseBtn = document.getElementById('play-pause-btn');
    const nextBtn = document.getElementById('next-btn');
    const prevBtn = document.getElementById('prev-btn');
    const retryBtn = document.getElementById('retry-button');

    // Đưa tất cả các nút điều khiển vào một mảng
    const controlButtons = [playPauseBtn, nextBtn, prevBtn];

    function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
            height: '100%', width: '100%',
            playerVars: { 'playsinline': 1, 'controls': 0, 'disablekb': 1, 'modestbranding': 1 },
            events: {
                'onReady': onPlayerReady,
                'onStateChange': onPlayerStateChange,
                'onError': onPlayerError
            }
        });
    }

    function onPlayerReady(event) {
        songTitleElement.textContent = "Nhấn Play để bắt đầu";
        // KÍCH HOẠT CÁC NÚT ĐIỀU KHIỂN
        controlButtons.forEach(button => button.disabled = false);
    }

    function onPlayerStateChange(event) {
        // ... (code không thay đổi)
    }

    function onPlayerError(event) {
        // ... (code không thay đổi)
    }

    // ... (Các hàm loadAndPlaySong, playNext, playPrev không thay đổi)

    playPauseBtn.addEventListener('click', () => {
        // Không cần kiểm tra isPlayerReady() nữa vì nút đã bị vô hiệu hóa lúc đầu
        const playerState = player.getPlayerState();
        const isPlayerEmpty = player.getVideoUrl().indexOf('blank') !== -1;
        if (isPlayerEmpty) {
            loadAndPlaySong(0);
        } else {
            if (playerState !== YT.PlayerState.PLAYING) {
                player.playVideo();
            } else {
                player.pauseVideo();
            }
        }
    });

    nextBtn.addEventListener('click', playNext);
    prevBtn.addEventListener('click', playPrev);
    retryBtn.addEventListener('click', () => {
        loadAndPlaySong(currentTrack);
    });

    document.getElementById('visualizer').style.display = 'none';

    // Giữ nguyên các hàm còn lại ở đây
    function loadAndPlaySong(trackIndex) { currentTrack = trackIndex; player.loadVideoById(playlist[currentTrack].videoId); songTitleElement.textContent = playlist[currentTrack].title; }
    function playNext() { let nextTrack = (currentTrack + 1) % playlist.length; loadAndPlaySong(nextTrack); }
    function playPrev() { let prevTrack = (currentTrack - 1 + playlist.length) % playlist.length; loadAndPlaySong(prevTrack); }

</script>

</body>
</html>