<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>H·ª©ng Qu√† T√¨nh Y√™u üéÅ</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #87CEEB; /* Tr·ªùi xanh */
            font-family: 'VT323', monospace;
            touch-action: none; /* Ch·∫∑n zoom tr√™n ƒëi·ªán tho·∫°i */
        }

        /* Khu v·ª±c ch∆°i game */
        #game-area {
            position: relative;
            width: 100vw;
            height: 100vh;
            background-image: url('https://cdn-icons-png.flaticon.com/512/2560/2560569.png'); /* M√¢y n·ªÅn */
            background-size: 200px;
            background-repeat: space;
            overflow: hidden;
        }

        /* B·∫£ng ƒëi·ªÉm */
        .hud {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #fff;
            font-size: 2rem;
            text-shadow: 2px 2px #000;
            z-index: 10;
        }

        #timer { right: 10px; left: auto; }

        /* Nh√¢n v·∫≠t (C√°i gi·ªè ho·∫∑c h√¨nh chibi) */
        #player {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 80px;
            background-image: url('https://cdn-icons-png.flaticon.com/512/4692/4692296.png'); /* H√¨nh con m√®o c·∫ßm gi·ªè */
            background-size: contain;
            background-repeat: no-repeat;
            transition: left 0.1s linear; /* Di chuy·ªÉn m∆∞·ª£t */
            z-index: 5;
        }

        /* V·∫≠t ph·∫©m r∆°i */
        .item {
            position: absolute;
            top: -50px;
            width: 50px;
            height: 50px;
            font-size: 40px;
            text-align: center;
            line-height: 50px;
            z-index: 4;
        }

        /* M√†n h√¨nh b·∫Øt ƒë·∫ßu/k·∫øt th√∫c */
        .overlay {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            color: white;
            text-align: center;
        }

        h1 { font-size: 3rem; margin: 0; color: #FF69B4; text-shadow: 3px 3px #fff; }
        p { font-size: 1.5rem; margin: 10px 0; }

        .btn {
            background: #FF69B4;
            color: white;
            border: 4px solid #fff;
            padding: 15px 30px;
            font-size: 1.5rem;
            font-family: 'VT323', monospace;
            cursor: pointer;
            margin-top: 20px;
        }
        .btn:active { transform: scale(0.95); }

        .controls-hint {
            position: absolute;
            bottom: 50px;
            width: 100%;
            text-align: center;
            color: rgba(255,255,255,0.8);
            font-size: 1.2rem;
            pointer-events: none;
        }
    </style>
</head>
<body>

<div id="game-area">
    <div class="hud">ƒêi·ªÉm: <span id="score">0</span></div>
    <div class="hud" id="timer">60</div>

    <div id="player"></div>

    <div class="overlay" id="start-screen">
        <h1>H·ª®NG QU√Ä<br>T√åNH Y√äU</h1>
        <p>Di chuy·ªÉn ƒë·ªÉ h·ª©ng qu√† üéÅ<br>Tr√°nh xa bom nh√© üí£</p>
        <button class="btn" onclick="startGame()">B·∫ÆT ƒê·∫¶U</button>
        <a href="/" style="color:white; margin-top:20px; text-decoration:none;">‚¨Ö V·ªÅ trang ch·ªß</a>
    </div>

    <div class="overlay" id="game-over-screen" style="display: none;">
        <h1>H·∫æT GI·ªú!</h1>
        <p>ƒêi·ªÉm c·ªßa em: <span id="final-score">0</span></p>
        <button class="btn" onclick="location.reload()">CH∆†I L·∫†I</button>
        <a href="/" style="color:white; margin-top:20px; text-decoration:none;">‚¨Ö V·ªÅ trang ch·ªß</a>
    </div>

    <div class="controls-hint" id="hint">Vu·ªët m√†n h√¨nh ho·∫∑c d√πng m≈©i t√™n tr√°i/ph·∫£i</div>
</div>

<script>
    const gameArea = document.getElementById('game-area');
    const player = document.getElementById('player');
    const scoreEl = document.getElementById('score');
    const timerEl = document.getElementById('timer');

    let score = 0;
    let timeLeft = 60;
    let gameInterval;
    let spawnInterval;
    let isPlaying = false;
    let playerX = 50; // V·ªã tr√≠ player (ph·∫ßn trƒÉm)

    // C√°c lo·∫°i v·∫≠t ph·∫©m
    const items = [
        { type: 'good', icon: 'üéÅ', score: 10 },
        { type: 'good', icon: 'üíå', score: 5 },
        { type: 'good', icon: 'üåπ', score: 5 },
        { type: 'good', icon: 'üíé', score: 20 }, // Kim c∆∞∆°ng hi·∫øm
        { type: 'bad', icon: 'üí£', score: -10 },
        { type: 'bad', icon: 'üß±', score: -5 }
    ];

    // --- ƒêI·ªÄU KHI·ªÇN ---

    // 1. Cho m√°y t√≠nh (Ph√≠m m≈©i t√™n)
    document.addEventListener('keydown', (e) => {
        if (!isPlaying) return;
        if (e.key === 'ArrowLeft') movePlayer(-5);
        if (e.key === 'ArrowRight') movePlayer(5);
    });

    // 2. Cho ƒëi·ªán tho·∫°i (Vu·ªët / Touch)
    gameArea.addEventListener('touchmove', (e) => {
        if (!isPlaying) return;
        e.preventDefault(); // Ch·∫∑n cu·ªôn trang
        const touchX = e.touches[0].clientX;
        const screenW = window.innerWidth;
        // Chuy·ªÉn ƒë·ªïi t·ªça ƒë·ªô touch sang ph·∫ßn trƒÉm (0 - 100)
        let newPos = (touchX / screenW) * 100;
        playerX = newPos;
        updatePlayerPos();
    }, { passive: false });

    // Di chuy·ªÉn chu·ªôt (ƒë·ªÉ test tr√™n PC d·ªÖ h∆°n)
    gameArea.addEventListener('mousemove', (e) => {
        if (!isPlaying) return;
        const screenW = window.innerWidth;
        playerX = (e.clientX / screenW) * 100;
        updatePlayerPos();
    });

    function movePlayer(delta) {
        playerX += delta;
        updatePlayerPos();
    }

    function updatePlayerPos() {
        // Gi·ªõi h·∫°n trong m√†n h√¨nh (0% - 90%)
        if (playerX < 0) playerX = 0;
        if (playerX > 90) playerX = 90;
        player.style.left = playerX + '%';
    }

    // --- LOGIC GAME ---

    function startGame() {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('hint').style.display = 'block';

        // ·∫®n h∆∞·ªõng d·∫´n sau 3s
        setTimeout(() => document.getElementById('hint').style.display = 'none', 3000);

        isPlaying = true;
        score = 0;
        timeLeft = 60;
        scoreEl.innerText = score;
        timerEl.innerText = timeLeft;

        // V√≤ng l·∫∑p ƒë·∫øm ng∆∞·ª£c
        gameInterval = setInterval(() => {
            timeLeft--;
            timerEl.innerText = timeLeft;
            if (timeLeft <= 0) endGame();
        }, 1000);

        // V√≤ng l·∫∑p sinh v·∫≠t ph·∫©m (T·ªëc ƒë·ªô tƒÉng d·∫ßn c√≥ th·ªÉ l√†m sau)
        spawnInterval = setInterval(spawnItem, 600); // 0.6s ra 1 c√°i
    }

    function spawnItem() {
        if (!isPlaying) return;

        const itemData = items[Math.floor(Math.random() * items.length)];
        const item = document.createElement('div');
        item.classList.add('item');
        item.innerText = itemData.icon;

        // V·ªã tr√≠ ng·∫´u nhi√™n (0 - 90%)
        const leftPos = Math.floor(Math.random() * 90);
        item.style.left = leftPos + '%';

        // L∆∞u d·ªØ li·ªáu v√†o element
        item.dataset.type = itemData.type;
        item.dataset.score = itemData.score;

        gameArea.appendChild(item);

        // R∆°i xu·ªëng
        let itemTop = -50;
        // T·ªëc ƒë·ªô r∆°i ng·∫´u nhi√™n
        let speed = Math.random() * 3 + 2; // 2 - 5px m·ªói frame

        const fallInterval = setInterval(() => {
            if (!isPlaying) {
                clearInterval(fallInterval);
                return;
            }

            itemTop += speed;
            item.style.top = itemTop + 'px';

            // Ki·ªÉm tra va ch·∫°m v·ªõi Player
            const playerRect = player.getBoundingClientRect();
            const itemRect = item.getBoundingClientRect();

            // Logic va ch·∫°m ƒë∆°n gi·∫£n
            if (
                itemRect.bottom >= playerRect.top + 20 && // Ch·∫°m ph·∫ßn tr√™n gi·ªè
                itemRect.top < playerRect.bottom &&
                itemRect.right >= playerRect.left + 20 &&
                itemRect.left <= playerRect.right - 20
            ) {
                // Tr√∫ng!
                catchItem(item, parseInt(item.dataset.score), fallInterval);
            }

            // Ra kh·ªèi m√†n h√¨nh
            if (itemTop > window.innerHeight) {
                clearInterval(fallInterval);
                if (item.parentNode) item.remove();
            }
        }, 16); // ~60fps
    }

    function catchItem(item, points, interval) {
        clearInterval(interval);
        item.remove();

        score += points;
        scoreEl.innerText = score;

        // Hi·ªáu ·ª©ng n·ªï/bay ƒëi·ªÉm (ƒë∆°n gi·∫£n h√≥a l√† ƒë·ªïi m√†u ƒëi·ªÉm s·ªë)
        if (points > 0) {
            scoreEl.style.color = '#00FF00'; // Xanh
        } else {
            scoreEl.style.color = '#FF0000'; // ƒê·ªè
            // Rung m√†n h√¨nh n·∫øu d√≠nh bom
            gameArea.style.transform = 'translate(5px, 5px)';
            setTimeout(() => gameArea.style.transform = 'none', 100);
        }
        setTimeout(() => scoreEl.style.color = '#fff', 300);
    }

    function endGame() {
        isPlaying = false;
        clearInterval(gameInterval);
        clearInterval(spawnInterval);

        // X√≥a h·∫øt v·∫≠t ph·∫©m c√≤n l·∫°i
        document.querySelectorAll('.item').forEach(e => e.remove());

        document.getElementById('game-over-screen').style.display = 'flex';
        document.getElementById('final-score').innerText = score;

        // G·ª≠i ƒëi·ªÉm v·ªÅ Discord
        if (score > 0) {
            fetch(`/api/catch-score?score=${score}`, { method: 'POST' });
        }
    }

</script>
</body>
</html>