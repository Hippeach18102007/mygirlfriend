<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gi√°ng Sinh C·ªßa Ch√∫ng M√¨nh üéÑ</title>
  <link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@700&display=swap" rel="stylesheet">
  <style>
    body {
      background-color: #1a2938; /* M√†u tr·ªùi ƒë√™m */
      background-image: linear-gradient(to bottom, #1a2938, #3b5368);
      min-height: 100vh;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: 'Mountains of Christmas', cursive;
      overflow: hidden;
      position: relative;
    }

    /* Hi·ªáu ·ª©ng tuy·∫øt r∆°i */
    .snowflake {
      position: absolute;
      top: -10px;
      color: #fff;
      font-size: 1em;
      animation: fall linear infinite;
      z-index: 1;
    }

    @keyframes fall {
      to { transform: translateY(110vh); }
    }

    h1 {
      color: #e74c3c;
      font-size: 3rem;
      text-shadow: 0 0 10px #fff;
      margin-bottom: 10px;
      z-index: 10;
      text-align: center;
    }

    .countdown {
      color: #f1c40f;
      font-size: 1.5rem;
      margin-bottom: 30px;
      z-index: 10;
      background: rgba(0,0,0,0.5);
      padding: 10px 20px;
      border-radius: 20px;
    }

    /* C√¢y th√¥ng Noel (D√πng ·∫£nh cho ƒë·∫πp v√† nh·∫π) */
    .tree-container {
      position: relative;
      z-index: 5;
      margin-bottom: 20px;
    }

    .tree-img {
      width: 300px;
      filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.3));
    }

    /* Khu v·ª±c h·ªôp qu√† */
    .gift-area {
      display: flex;
      gap: 30px;
      z-index: 10;
      justify-content: center;
      align-items: flex-end;
    }

    .gift-box {
      width: 80px;
      height: 80px;
      background: #e74c3c;
      position: relative;
      cursor: pointer;
      transition: transform 0.3s;
      box-shadow: 0 10px 20px rgba(0,0,0,0.5);
    }

    /* N·∫Øp h·ªôp */
    .gift-box::before {
      content: '';
      position: absolute;
      width: 90px;
      height: 20px;
      background: #c0392b;
      top: -20px;
      left: -5px;
      border-radius: 2px;
      transition: transform 0.5s;
    }

    /* N∆° d·ªçc */
    .gift-box::after {
      content: '';
      position: absolute;
      width: 15px;
      height: 100%;
      background: #f1c40f;
      left: 50%;
      transform: translateX(-50%);
    }

    /* M√†u s·∫Øc kh√°c nhau cho t·ª´ng h·ªôp */
    .box-1 { background: #e74c3c; } /* ƒê·ªè */
    .box-1::before { background: #c0392b; }

    .box-2 { background: #2ecc71; } /* Xanh */
    .box-2::before { background: #27ae60; }
    .box-2::after { background: #e74c3c; } /* N∆° ƒë·ªè */

    .box-3 { background: #3498db; } /* Lam */
    .box-3::before { background: #2980b9; }
    .box-3::after { background: #ecf0f1; } /* N∆° tr·∫Øng */

    .gift-box:hover {
      transform: translateY(-10px) scale(1.05);
    }

    /* Tr·∫°ng th√°i ƒë√£ m·ªü */
    .gift-box.opened {
      opacity: 0.5;
      cursor: default;
      transform: none;
    }
    .gift-box.opened::before {
      transform: translateY(-50px) rotate(-20deg);
      opacity: 0;
    }

    /* Popup k·∫øt qu·∫£ */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: #fff;
      padding: 40px;
      border-radius: 10px;
      text-align: center;
      font-family: 'Arial', sans-serif;
      max-width: 400px;
      animation: popIn 0.5s;
      position: relative;
      border: 5px solid #c0392b;
    }

    @keyframes popIn {
      from { transform: scale(0); }
      to { transform: scale(1); }
    }

    .prize-text {
      color: #c0392b;
      font-size: 1.5rem;
      font-weight: bold;
      margin: 20px 0;
    }
  </style>
</head>
<body>

<a href="/" style="position:absolute; top:20px; left:20px; color:white; text-decoration:none;">‚¨Ö Trang ch·ªß</a>

<h1>Merry Christmas 2025 üéÖ</h1>
<div class="countdown" id="timer">ƒêang ki·ªÉm tra th·ªùi gian...</div>

<div class="tree-container">
  <img src="https://cdn-icons-png.flaticon.com/512/622/622839.png" class="tree-img" alt="Xmas Tree">
</div>

<div class="gift-area">
  <div class="gift-box box-1" onclick="tryOpen(1)"></div>
  <div class="gift-box box-2" onclick="tryOpen(2)"></div>
  <div class="gift-box box-3" onclick="tryOpen(3)"></div>
</div>

<p style="color: #fff; margin-top: 20px; font-family: Arial;">Ch·ªâ ƒë∆∞·ª£c ch·ªçn 1 h·ªôp duy nh·∫•t!</p>

<div class="modal" id="resultModal">
  <div class="modal-content">
    <h2 style="color: #27ae60;">üéâ CH√öC M·ª™NG GI√ÅNG SINH! üéâ</h2>
    <img src="https://media.giphy.com/media/zhh9ivpOs0vtKc3Q0i/giphy.gif" style="width: 150px;">
    <p>M√≥n qu√† c·ªßa em l√†:</p>
    <div class="prize-text" id="prizeName">...</div>
    <p style="font-size: 0.9rem; color: #555;">(Anh ƒë√£ nh·∫≠n ƒë∆∞·ª£c tin nh·∫Øn v√† s·∫Ω trao qu√† cho em s·ªõm nh·∫•t!)</p>
    <button onclick="location.reload()" style="padding: 10px 20px; cursor: pointer;">ƒê√≥ng</button>
  </div>
</div>

<script>
  // --- C·∫§U H√åNH ---
  const XMAS_DATE = new Date("2025-12-25T00:00:00");
  const timerEl = document.getElementById('timer');

  // T·∫°o tuy·∫øt r∆°i
  function createSnow() {
    const snow = document.createElement('div');
    snow.innerHTML = '‚ùÑ';
    snow.className = 'snowflake';
    snow.style.left = Math.random() * 100 + 'vw';
    snow.style.animationDuration = Math.random() * 3 + 2 + 's';
    snow.style.opacity = Math.random();
    snow.style.fontSize = Math.random() * 10 + 10 + 'px';

    document.body.appendChild(snow);

    setTimeout(() => {
      snow.remove();
    }, 5000);
  }
  setInterval(createSnow, 100);

  // ƒê·∫øm ng∆∞·ª£c
  function updateTimer() {
    const now = new Date();
    const distance = XMAS_DATE - now;

    if (distance < 0) {
      timerEl.innerText = "üéÑ ƒê√É ƒê·∫æN GI√ÅNG SINH! M·ªû QU√Ä TH√îI! üéÑ";
      timerEl.style.color = "#2ecc71";
    } else {
      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((distance % (1000 * 60)) / 1000);
      timerEl.innerText = `‚è≥ M·ªü qu√† sau: ${days} ng√†y ${hours}g ${minutes}p ${seconds}s`;
    }
  }
  setInterval(updateTimer, 1000);
  updateTimer();

  // X·ª≠ l√Ω m·ªü qu√†
  function tryOpen(boxId) {
    // 1. Ki·ªÉm tra n·∫øu ƒë√£ m·ªü r·ªìi (trong localStorage)
    const openedGift = localStorage.getItem('xmas_gift_2025');
    if (openedGift) {
      alert(`Em ƒë√£ m·ªü qu√† r·ªìi m√†! Em ƒë√£ ch·ªçn h·ªôp s·ªë ${openedGift}. Kh√¥ng ƒë∆∞·ª£c tham lam nha üòò`);
      return;
    }

    // 2. Ki·ªÉm tra th·ªùi gian client (cho vui th√¥i, server m·ªõi quan tr·ªçng)
    const now = new Date();
    if (now < XMAS_DATE) {
      alert("Ho Ho Ho! üéÖ Ch∆∞a ƒë·∫øn Gi√°ng Sinh ƒë√¢u b√© ∆°i! Ki√™n nh·∫´n ch·ªù ƒë·∫øn 25/12 nh√©!");
      return;
    }

    // 3. H·ªèi x√°c nh·∫≠n
    if (confirm(`Em ch·∫Øc ch·∫Øn ch·ªçn H·ªôp qu√† s·ªë ${boxId} ch·ª©? Ch·ªâ ƒë∆∞·ª£c ch·ªçn 1 l·∫ßn th√¥i ƒë√≥!`)) {

      // 4. G·ª≠i request l√™n server
      fetch(`/api/open-gift?boxId=${boxId}`, { method: 'POST' })
              .then(async response => {
                if (response.ok) {
                  const giftName = await response.text();

                  // L∆∞u l·∫°i l√† ƒë√£ m·ªü
                  localStorage.setItem('xmas_gift_2025', boxId);

                  // Hi·ªán k·∫øt qu·∫£
                  document.getElementById('prizeName').innerText = giftName;
                  document.getElementById('resultModal').style.display = 'flex';
                } else {
                  const errorMsg = await response.text();
                  alert(errorMsg);
                }
              })
              .catch(err => alert("L·ªói k·∫øt n·ªëi!"));
    }
  }
</script>
</body>
</html>