<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gi√°ng Sinh ·∫§m √Åp Nh√© Ch·ªã!</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #d32f2f;
            --secondary-color: #388e3c;
            --gold-color: #ffb300;
            --bg-gradient: linear-gradient(to top, rgba(20, 30, 48, 0.8), rgba(36, 59, 85, 0.8));
        }

        body {
            margin: 0; padding: 20px;
            font-family: 'Nunito', sans-serif;
            display: flex; justify-content: center; align-items: center; min-height: 100vh;
            background-image: var(--bg-gradient), url('https://images.unsplash.com/photo-1542384557-0824d90731ee?q=80&w=1920&auto-format&fit=crop');
            background-repeat: no-repeat; background-position: center center; background-size: cover;
            overflow-x: hidden;
        }

        .letter-container {
            background-color: #fffaf0; padding: 50px 50px; border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5); max-width: 600px; width: 90%;
            text-align: center; border: 2px solid #c0392b; position: relative; z-index: 10;
        }

        /* D√¢y ƒë√®n */
        .lights {
            position: absolute; top: -15px; left: 0; width: 100%; height: 30px;
            background-image: url('https://raw.githubusercontent.com/s1mpson/christmas-lights/master/lights.png');
            background-size: contain; background-repeat: repeat-x; animation: twinkle 2s infinite;
        }
        @keyframes twinkle { 0% { opacity: 0.8; } 50% { opacity: 1; filter: brightness(1.2); } 100% { opacity: 0.8; } }

        h1 {
            font-family: 'Dancing Script', cursive; font-weight: 700; font-size: 3.5em;
            color: var(--primary-color); margin-bottom: 20px; text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        h2, .signature { font-family: 'Dancing Script', cursive; }
        h2 { color: var(--secondary-color); font-size: 2em; }
        .message { font-size: 1.1em; line-height: 1.8; color: #333; text-align: left; margin-bottom: 30px; }
        .signature { font-style: italic; font-size: 1.5em; color: var(--primary-color); text-align: right; margin-top: 20px; }

        @keyframes fade-in-up { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .letter-container { animation: fade-in-up 0.8s forwards cubic-bezier(0.2, 0.8, 0.2, 1); }
        .heart-container { position: relative; display: inline-block; animation: beat 1.5s infinite, fade-in-up 0.8s 0.2s forwards; opacity: 0; }
        h1 { animation: fade-in-up 0.8s 0.4s forwards; opacity: 0; }
        .message { animation: fade-in-up 0.8s 0.6s forwards; opacity: 0; }
        .signature { animation: fade-in-up 0.8s 0.8s forwards; opacity: 0; }
        .reasons-section { animation: fade-in-up 0.8s 0.9s forwards; opacity: 0; }
        .memories-link { animation: fade-in-up 0.8s 1.0s forwards; opacity: 0; }
        .reply-section { animation: fade-in-up 0.8s 1.1s forwards; opacity: 0; }

        .heart { font-size: 3.5em; color: var(--primary-color); display: inline-block; }
        .santa-hat { position: absolute; top: -20px; left: -15px; font-size: 2.5rem; transform: rotate(-20deg); }
        @keyframes beat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }

        .reasons-section { text-align: center; margin-top: 40px; padding: 30px 0; border-top: 1px dashed var(--secondary-color); border-bottom: 1px dashed var(--secondary-color); }

        #reason-button {
            background-color: var(--secondary-color); color: white; border: none; padding: 15px 30px;
            font-size: 1.1em; font-family: 'Nunito', sans-serif; font-weight: bold;
            border-radius: 50px; cursor: pointer; margin-bottom: 20px; transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(56, 142, 60, 0.4); border: 2px solid white;
        }
        #reason-button:hover { background-color: var(--primary-color); transform: scale(1.05); box-shadow: 0 4px 15px rgba(211, 47, 47, 0.4); }
        #reason-display { font-family: 'Dancing Script', cursive; font-size: 1.6em; color: #333; min-height: 50px; transition: opacity 0.5s; }
        #reason-display.fade { opacity: 0; }

        .memories-link { display: flex; justify-content: center; gap: 10px; margin-top: 30px; padding-bottom: 30px; flex-wrap: wrap; }
        .memory-button {
            background-color: white; color: var(--primary-color); border: 2px solid var(--primary-color);
            padding: 8px 18px; font-size: 0.95em; font-family: 'Nunito', sans-serif; font-weight: bold;
            border-radius: 50px; cursor: pointer; text-decoration: none; transition: all 0.3s;
        }
        .memory-button:hover { background-color: var(--primary-color); color: white; transform: scale(1.05); border-color: var(--primary-color); }
        .memory-button:nth-child(even) { color: var(--secondary-color); border-color: var(--secondary-color); }
        .memory-button:nth-child(even):hover { background-color: var(--secondary-color); color: white; }

        .reply-section { margin-top: 20px; border-top: 1px dashed var(--secondary-color); padding-top: 30px; }
        textarea { width: 100%; min-height: 100px; padding: 15px; font-family: 'Nunito', sans-serif; font-size: 1em; border-radius: 8px; border: 1px solid #ccc; margin-top: 10px; box-sizing: border-box; transition: box-shadow 0.3s; }
        textarea:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 10px rgba(211, 47, 47, 0.2); }
        #submitButton {
            background-color: var(--primary-color); color: white; border: none; padding: 12px 25px;
            font-size: 1.1em; font-family: 'Nunito', sans-serif; font-weight: bold;
            border-radius: 50px; cursor: pointer; margin-top: 15px; transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(211, 47, 47, 0.4);
        }
        #submitButton:hover { background-color: #b71c1c; transform: translateY(-2px); }

        .snowflake { position: fixed; top: -10px; color: #fff; font-size: 1em; font-family: Arial, sans-serif; text-shadow: 0 0 5px #000; user-select: none; z-index: 1; pointer-events: none; animation-name: fall; animation-timing-function: linear; animation-iteration-count: infinite; }
        @keyframes fall { to { transform: translateY(105vh); } }

        .gift-section { text-align: center; margin-top: 30px; animation: fade-in-up 0.8s 0.95s forwards; opacity: 0; }
        #gift-button {
            background: linear-gradient(45deg, var(--primary-color), var(--gold-color));
            color: white; border: none; padding: 18px 35px;
            font-size: 1.3em; font-family: 'Dancing Script', cursive; font-weight: bold;
            border-radius: 50px; cursor: pointer; margin-bottom: 20px; transition: all 0.3s ease-in-out;
            box-shadow: 0 6px 20px rgba(211, 47, 47, 0.5); text-shadow: 1px 1px 2px rgba(0,0,0,0.3); border: 2px solid white;
        }
        #gift-button:hover { transform: translateY(-5px) scale(1.05); box-shadow: 0 10px 25px rgba(255, 179, 0, 0.6); }

        .modal { display: none; position: fixed; z-index: 1001; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-content {
            background: linear-gradient(145deg, #b71c1c, #004d40); padding: 30px 40px; border-radius: 20px; text-align: center; border: 4px double #ffd700;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3); width: 90%; max-width: 450px; position: relative; animation: zoom-in 0.5s forwards; color: white;
        }
        .close-modal-button { position: absolute; top: 10px; right: 20px; color: #ffd700; font-size: 35px; cursor: pointer; transition: color 0.3s; }
        .close-modal-button:hover { color: #fff; }
        .modal-content h2 { font-family: 'Dancing Script', cursive; color: #ffd700; font-size: 2.5em; }

        /* S·ª¨A L·ªñI ·∫¢NH GIFT: ƒê·ªãnh d·∫°ng ·∫£nh trong modal */
        .gift-image {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin: 15px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            border: 2px solid #fff;
        }

        #volume-toggle { position: fixed; bottom: 20px; right: 20px; width: 50px; height: 50px; background-color: var(--primary-color); color: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 24px; cursor: pointer; z-index: 1001; transition: background-color 0.3s, transform 0.3s; border: 2px solid white; box-shadow: 0 0 10px white; }
        #volume-toggle:hover { background-color: var(--secondary-color); transform: scale(1.1); }
    </style>
</head>
<body>

<div id="snow-container"></div>

<audio id="christmas-audio" loop preload="auto">
    <source src="https://raw.githubusercontent.com/s1mpson/christmas-lights/master/jingle-bells.mp3" type="audio/mpeg">
</audio>

<div class="letter-container">
    <div class="lights"></div>
    <div class="heart-container">
        <span class="santa-hat">üéÖ</span>
        <div class="heart">&#10084;</div>
    </div>

    <h1>G·ª≠i Ch·ªã, Gi√°ng Sinh Vui V·∫ª! üéÑ</h1>

    <div class="content-wrapper">
        <p>G·ª≠i ch·ªã <b><span th:text="${tenNguoiNhan}"></span></b> c·ªßa em,</p>
        <p class="message" th:utext="${loiNhanYeuThuong}"></p>
        <p class="signature">Th∆∞∆°ng ch·ªã nh·∫•t,<br><span th:text="${tenNguoiGui}"></span> ‚òÉÔ∏è</p>
    </div>

    <div class="reasons-section">
        <button id="reason-button">Sao em l·∫°i th∆∞∆°ng ch·ªã?</button>
        <p id="reason-display">Nh·∫•n v√†o ƒë·ªÉ xem ƒëi·ªÅu ∆∞·ªõc Gi√°ng Sinh c·ªßa em nh√©! ‚ùÑÔ∏è</p>
    </div>

    <div class="gift-section">
        <button id="gift-button">üéÅ M·ªü qu√† Noel! üéÅ</button>
    </div>

    <div class="memories-link">
        <a th:href="@{/dem-ngay}" class="memory-button">ƒê·∫øm Ng√†y Y√™u üíñ</a>
        <a th:href="@{/ky-niem}" class="memory-button">Xem K·ª∑ Ni·ªám üì∏</a>
        <a th:href="@{/nghe-nhac}" class="memory-button">Nh·∫°c Gi√°ng Sinh üé∂</a>
        <a th:href="@{/vong-quay}" class="memory-button">V√≤ng Quay May M·∫Øn üéÅ</a>
        <a th:href="@{/ghep-hinh}" class="memory-button">Gh√©p H√¨nh Noel</a>
        <a th:href="@{/mon-an}" class="memory-button">ƒÇn G√¨ ƒê√™m Noel?</a>
        <a th:href="@{/bai-hoc}" class="memory-button">B√†i H·ªçc T√¨nh Y√™u</a>
        <a th:href="@{/tro-choi-nho}" class="memory-button">Game T√¨nh Y√™u</a>
        <a th:href="@{/trac-nghiem}" class="memory-button">Tr·∫Øc Nghi·ªám</a>
        <a th:href="@{/truth-or-dare}" class="memory-button">S·ª± Th·∫≠t/Th·ª≠ Th√°ch?</a>
        <a th:href="@{/thoi-tiet}" class="memory-button">Th·ªùi Ti·∫øt ƒê√™m Nay ‚ùÑÔ∏è</a>
        <a th:href="@{/open-when}" class="memory-button">M·ªü khi...</a>
        <a th:href="@{/timeline}" class="memory-button">D√≤ng Th·ªùi Gian</a>
        <a th:href="@{/love-map}" class="memory-button">B·∫£n ƒê·ªì Y√™u</a>
        <a th:href="@{/safe}" class="memory-button">K√©t S·∫Øt B√≠ M·∫≠t</a>
        <a th:href="@{/store}" class="memory-button">C·ª≠a H√†ng H·∫°nh Ph√∫c</a>
        <a th:href="@{/challenge}" class="memory-button">30 Ng√†y Y√™u</a>
        <a th:href="@{/christmas}" class="memory-button">Gi√°ng Sinh</a>
        <a th:href="@{/game-kho}" class="memory-button">Flappy heart</a>
        <a th:href="@{/game-piano}" class="memory-button">Piano</a>
        <a th:href="@{/game-2048}" class="memory-button">Kh√¥ng bi·∫øt ƒë·∫∑t t√™n j</a>
        <a th:href="@{/game-snake}" class="memory-button">R·∫Øn ƒë·ªôc:))</a>
        <a th:href="@{/garden}" class="memory-button">C√¢y t√¨nh y√™u</a>
        <a th:href="@{/pharmacy}" class="memory-button">Hi·ªáu thu·ªëc nh·ªè</a>
        <a th:href="@{/heart-game}" class="memory-button">Tr√°i tim</a>
        <a th:href="@{/catch-game}" class="memory-button">B·∫Øt t·ªÅnh y√™u</a>
        <a th:href="@{/ticket}" class="memory-button">T·∫•m v√©</a>
        <a th:href="@{/tarot}" class="memory-button">B√†i Tarot</a>
        <a th:href="@{/kitchen}" class="memory-button">Gian b·∫øp y√™u th∆∞∆°ng</a>
        <a th:href="@{/star}" class="memory-button">üåü H≈© Sao Hy V·ªçng</a>
        <a th:href="@{/shooter}" class="memory-button">ƒê·∫°i chi·∫øn t√¨nh y√™u (2 ng∆∞·ªùi ch∆°i)</a>


    </div>

    <div class="reply-section">
        <h2>Ch·ªã mu·ªën nh·∫Øn nh·ªß √¥ng gi√† Noel (l√† em) ƒëi·ªÅu g√¨ kh√¥ng?</h2>
        <form id="replyForm" th:action="@{/gui-chi}" method="post" enctype="multipart/form-data">
            <textarea name="reply_message" placeholder="Vi·∫øt ƒëi·ªÅu ∆∞·ªõc ho·∫∑c l·ªùi nh·∫Øn cho em ·ªü ƒë√¢y nh√©..." required></textarea>
            <input type="file" name="imageFile" accept="image/*">
            <button id="submitButton" type="submit">üéÑ G·ª≠i cho em</button>
        </form>
        <div id="statusMessage"></div>
    </div>
</div>

<div id="volume-toggle">üîá</div>

<div id="giftModal" class="modal">
    <div class="modal-content">
        <span class="close-modal-button">&times;</span>
        <h2>Merry Christmas! üéÖ</h2>
        <img src="https://images.unsplash.com/photo-1549465220-1a8b9238cd48?q=80&w=600&auto=format&fit=crop" alt="Qu√† Gi√°ng Sinh" class="gift-image">
        <p class="gift-message">Ch√∫c ch·ªã m·ªôt m√πa Gi√°ng Sinh an l√†nh, ·∫•m √°p v√† lu√¥n xinh ƒë·∫πp. M√≥n qu√† l·ªõn nh·∫•t c·ªßa em l√† ƒë∆∞·ª£c ·ªü b√™n ch·ªã! ‚ù§Ô∏è</p>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // --- X·ª¨ L√ù NH·∫†C (ƒê√É S·ª¨A L·ªñI AbortError) ---
        const audioPlayer = document.getElementById('christmas-audio');
        const volumeButton = document.getElementById('volume-toggle');
        let isPlaying = false; // Bi·∫øn tr·∫°ng th√°i ƒë·ªÉ tr√°nh conflict

        if (volumeButton && audioPlayer) {
            volumeButton.addEventListener('click', function() {
                if (!isPlaying) {
                    // N·∫øu ƒëang d·ª´ng th√¨ ph√°t
                    let playPromise = audioPlayer.play();
                    if (playPromise !== undefined) {
                        playPromise.then(_ => {
                            // Ph√°t th√†nh c√¥ng
                            volumeButton.textContent = 'üîä';
                            isPlaying = true;
                        })
                            .catch(error => {
                                // B·ªã ch·∫∑n ho·∫∑c l·ªói
                                console.log("Kh√¥ng th·ªÉ t·ª± ph√°t nh·∫°c: ", error);
                                alert("Ch·ªã ∆°i, ch·ªã nh·∫•n l·∫°i v√†o c√°i loa l·∫ßn n·ªØa nh√©!");
                            });
                    }
                } else {
                    // N·∫øu ƒëang ph√°t th√¨ d·ª´ng
                    audioPlayer.pause();
                    volumeButton.textContent = 'üîá';
                    isPlaying = false;
                }
            });
        }

        // --- HI·ªÜU ·ª®NG TUY·∫æT R∆†I ---
        function createSnowflake() {
            const snowflake = document.createElement('div');
            snowflake.classList.add('snowflake');
            snowflake.innerHTML = '‚ùÑ';
            snowflake.style.left = Math.random() * 100 + 'vw';
            snowflake.style.animationDuration = Math.random() * 3 + 2 + 's';
            snowflake.style.opacity = Math.random();
            snowflake.style.fontSize = Math.random() * 10 + 10 + 'px';
            document.body.appendChild(snowflake);
            setTimeout(() => { snowflake.remove(); }, 5000);
        }
        setInterval(createSnowflake, 100);

        // --- C√ÅC LOGIC KH√ÅC ---
        const form = document.getElementById('replyForm');
        const statusMessage = document.getElementById('statusMessage');
        const submitButton = document.getElementById('submitButton');
        if (form) {
            form.addEventListener('submit', function(event) {
                event.preventDefault();
                submitButton.disabled = true;
                submitButton.textContent = 'ƒêang g·ª≠i qua ·ªëng kh√≥i...';
                const formData = new FormData(form);
                fetch(form.action, { method: 'POST', body: formData })
                    .then(response => response.ok ? response.text() : Promise.reject(response))
                    .then(successMessage => {
                        statusMessage.textContent = successMessage;
                        statusMessage.className = 'success';
                        statusMessage.style.display = 'block';
                        statusMessage.style.color = 'green';
                        form.reset();
                    })
                    .catch(error => {
                        statusMessage.textContent = 'L·ªói ƒë∆∞·ªùng truy·ªÅn B·∫Øc C·ª±c r·ªìi ch·ªã ∆°i!';
                        statusMessage.className = 'error';
                        statusMessage.style.display = 'block';
                        statusMessage.style.color = 'red';
                    })
                    .finally(() => {
                        submitButton.disabled = false;
                        submitButton.innerHTML = 'üéÑ G·ª≠i cho em';
                    });
            });
        }

        const reasonButton = document.getElementById('reason-button');
        const reasonDisplay = document.getElementById('reason-display');
        if (reasonButton) {
            const reasons = [
                "Gi√°ng sinh n√†y em kh√¥ng c·∫ßn qu√†, v√¨ c√≥ ch·ªã l√† ƒë·ªß r·ªìi.",
                "Em y√™u ch·ªã v√¨ n·ª• c∆∞·ªùi ch·ªã ·∫•m h∆°n c·∫£ l√≤ s∆∞·ªüi.",
                "Th∆∞∆°ng ch·ªã v√¨ ch·ªã lu√¥n n·∫Øm tay em ƒëi qua m√πa ƒë√¥ng.",
                "ƒêi·ªÅu ∆∞·ªõc ƒë√™m Noel c·ªßa em l√†: NƒÉm n√†o c≈©ng ƒë∆∞·ª£c ƒë√≥n c√πng ch·ªã.",
                "Ch·ªã l√† ng√¥i sao s√°ng nh·∫•t tr√™n c√¢y th√¥ng c·ªßa ƒë·ªùi em.",
                "Y√™u ch·ªã v√¨ ch·ªã ngoan, √¥ng gi√† Noel ch·∫Øc ch·∫Øn s·∫Ω c√≥ qu√† cho ch·ªã!",
                "Em y√™u ch·ªã v√¨ m√πa ƒë√¥ng l·∫°nh nh∆∞ng tim em n√≥ng khi th·∫•y ch·ªã."
            ];
            reasonButton.addEventListener('click', function() {
                reasonDisplay.classList.add('fade');
                setTimeout(function() {
                    const randomIndex = Math.floor(Math.random() * reasons.length);
                    reasonDisplay.textContent = reasons[randomIndex];
                    reasonDisplay.classList.remove('fade');
                }, 500);
            });
        }

        const giftButton = document.getElementById('gift-button');
        const giftModal = document.getElementById('giftModal');
        if (giftButton && giftModal) {
            const closeModalButton = giftModal.querySelector('.close-modal-button');
            giftButton.addEventListener('click', () => giftModal.style.display = 'flex');
            closeModalButton.addEventListener('click', () => giftModal.style.display = 'none');
            window.addEventListener('click', (e) => { if (e.target === giftModal) giftModal.style.display = 'none'; });
        }
    });
</script>

</body>
</html>