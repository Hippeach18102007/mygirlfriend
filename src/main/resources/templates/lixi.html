<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>H√°i L·ªôc ƒê·∫ßu Xu√¢n 2026 üßß</title>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Pangolin&display=swap" rel="stylesheet">
  <style>
    body {
      background-color: #b71c1c; /* ƒê·ªè ƒë√¥ */
      background-image: radial-gradient(circle, #d32f2f, #8e0000);
      min-height: 100vh; margin: 0;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      font-family: 'Pangolin', cursive; overflow: hidden;
    }

    /* Hi·ªáu ·ª©ng m∆∞a v√†ng */
    .coin {
      position: absolute; top: -50px;
      font-size: 20px; animation: fall linear infinite; z-index: 1;
    }
    @keyframes fall { to { transform: translateY(110vh) rotate(360deg); } }

    h1 {
      font-family: 'Dancing Script', cursive; color: #ffd700;
      font-size: 3.5rem; text-shadow: 2px 2px 0 #000;
      margin-bottom: 10px; z-index: 10; text-align: center;
    }

    .subtitle { color: #ffecb3; font-size: 1.2rem; margin-bottom: 30px; z-index: 10; }

    /* Khu v·ª±c bao l√¨ x√¨ */
    .lixi-container {
      display: flex; gap: 20px; z-index: 10;
      flex-wrap: wrap; justify-content: center;
    }

    /* Thi·∫øt k·∫ø bao l√¨ x√¨ */
    .red-envelope {
      width: 100px; height: 160px;
      background: #e60000;
      border: 2px solid #ffd700;
      border-radius: 10px;
      position: relative; cursor: pointer;
      box-shadow: 0 10px 20px rgba(0,0,0,0.3);
      transition: all 0.3s;
      display: flex; align-items: center; justify-content: center;
      overflow: hidden;
    }

    /* H·ªça ti·∫øt tr√™n bao */
    .red-envelope::before {
      content: 'Á¶è'; /* Ch·ªØ Ph√∫c */
      font-size: 40px; color: #ffd700;
      border: 2px solid #ffd700; padding: 10px; border-radius: 50%;
      background: #b71c1c;
    }

    /* N·∫Øp bao */
    .red-envelope::after {
      content: ''; position: absolute; top: 0; left: 0;
      width: 100%; height: 40px;
      background: rgba(0,0,0,0.1);
      border-radius: 0 0 50% 50%;
    }

    .red-envelope:hover { transform: translateY(-10px) scale(1.05); box-shadow: 0 0 15px #ffd700; }
    .red-envelope.opened { opacity: 0.5; filter: grayscale(1); pointer-events: none; }

    /* Modal K·∫øt qu·∫£ */
    .modal {
      display: none; position: fixed; z-index: 1000;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      justify-content: center; align-items: center;
      backdrop-filter: blur(5px);
    }

    .modal-content {
      background: #fffbe6; padding: 30px; border-radius: 20px;
      text-align: center; border: 5px solid #d32f2f;
      animation: zoomIn 0.5s; max-width: 90%;
    }

    @keyframes zoomIn { from { transform: scale(0); } to { transform: scale(1); } }

    .money-text {
      color: #d32f2f; font-size: 2.5rem; font-weight: bold; margin: 20px 0;
      text-shadow: 1px 1px 0 #ffd700;
    }

    .congrats-img { width: 150px; margin-bottom: 10px; }

    button {
      background: #d32f2f; color: #fff; border: none; padding: 10px 25px;
      font-size: 1.2rem; border-radius: 50px; cursor: pointer;
      font-family: inherit;
    }
  </style>
</head>
<body>

<h1>Ch√∫c M·ª´ng NƒÉm M·ªõi 2026 üêç</h1>
<div class="subtitle">Ch·ªçn m·ªôt bao l√¨ x√¨ ƒë·ªÉ th·ª≠ v·∫≠n may ƒë·∫ßu nƒÉm nh√©!</div>

<div class="lixi-container">
  <div class="red-envelope" onclick="openLixi(1)"></div>
  <div class="red-envelope" onclick="openLixi(2)"></div>
  <div class="red-envelope" onclick="openLixi(3)"></div>
  <div class="red-envelope" onclick="openLixi(4)"></div>
  <div class="red-envelope" onclick="openLixi(5)"></div>
</div>

<div class="modal" id="resultModal">
  <div class="modal-content">
    <h2 style="color: #d32f2f; margin: 0;">üéâ L·ªòC V·ªÄ L·ªòC V·ªÄ! üéâ</h2>
    <img src="https://media.giphy.com/media/l4FGpP4w34wu9nU2Y/giphy.gif" class="congrats-img">
    <p>Ch√∫c m·ª´ng ch·ªã ƒë√£ nh·∫≠n ƒë∆∞·ª£c l√¨ x√¨:</p>
    <div class="money-text" id="prizeValue">...</div>
    <p style="font-size: 0.9rem; color: #555;">(Ch·ª•p m√†n h√¨nh g·ª≠i em ƒë·ªÉ nh·∫≠n ti·ªÅn nha!)</p>
    <button onclick="location.reload()">C·∫£m ∆°n em iu ‚ù§Ô∏è</button>
  </div>
</div>

<audio id="sound-coin" src="https://www.soundjay.com/misc/sounds/coins-in-hand-2.mp3"></audio>

<script>
  // 1. T·∫°o hi·ªáu ·ª©ng m∆∞a ti·ªÅn v√†ng
  function createCoin() {
    const coin = document.createElement('div');
    coin.innerHTML = Math.random() > 0.5 ? 'üí∞' : 'üå∏'; // Ti·ªÅn ho·∫∑c Hoa
    coin.className = 'coin';
    coin.style.left = Math.random() * 100 + 'vw';
    coin.style.animationDuration = Math.random() * 3 + 2 + 's';
    document.body.appendChild(coin);
    setTimeout(() => coin.remove(), 5000);
  }
  setInterval(createCoin, 300);

  // 2. X·ª≠ l√Ω m·ªü L√¨ X√¨
  const MAX_TURNS = 3;

  async function openLixi(id) {
    // 1. L·∫•y s·ªë l·∫ßn ƒë√£ r√∫t t·ª´ b·ªô nh·ªõ (n·∫øu ch∆∞a c√≥ th√¨ l√† 0)
    let count = parseInt(localStorage.getItem('count_lixi_2026') || 0);

    // 2. Ki·ªÉm tra xem c√≤n l∆∞·ª£t kh√¥ng
    if (count >= MAX_TURNS) {
      alert(`Tham qu√° nha! Ch·ªã ƒë√£ r√∫t h·∫øt ${MAX_TURNS} l·∫ßn r·ªìi! Ch·ªët ƒë∆°n ƒëi n√†o üòò`);
      return;
    }

    // 3. H·ªèi x√°c nh·∫≠n (Hi·ªÉn th·ªã s·ªë l∆∞·ª£t c√≤n l·∫°i)
    let remaining = MAX_TURNS - count;
    if(!confirm(`Ch·ªã ch·ªçn bao n√†y ƒë√∫ng kh√¥ng? (C√≤n ${remaining} l∆∞·ª£t r√∫t)`)) return;

    try {
      const response = await fetch('/api/boc-lixi', { method: 'POST' });
      if (response.ok) {
        const money = await response.text();

        document.getElementById('sound-coin').play();
        document.getElementById('prizeValue').innerText = money;
        document.getElementById('resultModal').style.display = 'flex';

        // ƒê√°nh d·∫•u bao n√†y ƒë√£ m·ªü (m·ªù ƒëi)
        document.querySelectorAll('.red-envelope')[id-1].classList.add('opened');

        // 4. TƒÉng s·ªë l·∫ßn ƒë√£ r√∫t v√† l∆∞u l·∫°i
        count++;
        localStorage.setItem('count_lixi_2026', count);
      } else {
        alert("L·ªói k·∫øt n·ªëi Server ƒë·∫ßu nƒÉm r·ªìi huhu!");
      }
    } catch (e) {
      console.error(e);
      alert("M·∫°ng lag qu√° ch·ªã ∆°i!");
    }
  }
</script>

</body>
</html>